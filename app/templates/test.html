<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•æŒ‡å— - Demucs éŸ³é¢‘åˆ†ç¦»å·¥å…·</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸ§ª æµ‹è¯•æŒ‡å—</h1>
            <p>å®Œæ•´çš„åŠŸèƒ½æµ‹è¯•æŒ‡å—ï¼Œç¡®ä¿ç³»ç»Ÿè¿è¡Œæ­£å¸¸</p>
            <div class="main-nav">
                <a href="/" class="nav-link">ğŸ  é¦–é¡µ</a>
                <a href="/mcp" class="nav-link">ğŸ”— MCPåè®®</a>
                <a href="/api-docs" class="nav-link">ğŸ“š APIæ–‡æ¡£</a>
                <a href="/docs" class="nav-link">ğŸ“– ä½¿ç”¨æŒ‡å—</a>
                <a href="/test-guide" class="nav-link active">ğŸ§ª æµ‹è¯•æŒ‡å—</a>
                <a href="/admin" class="nav-link">ğŸ› ï¸ ç®¡ç†é¢æ¿</a>
            </div>
        </div>
    </header>
    
    <div class="container container-sm">
        <!-- ç›®å½• -->
        <div class="card" style="background: #f8f9fa;">
            <h3>ğŸ“‹ æµ‹è¯•ç›®å½•</h3>
            <ul style="list-style: none; padding-left: 0;">
                <li style="margin: 8px 0;"><a href="#quick-tests" class="text-primary">âš¡ å¿«é€Ÿæµ‹è¯•</a></li>
                <li style="margin: 8px 0;"><a href="#api-tests" class="text-primary">ğŸ”§ APIæµ‹è¯•</a></li>
                <li style="margin: 8px 0;"><a href="#mcp-tests" class="text-primary">ğŸ”— MCPæµ‹è¯•</a></li>
                <li style="margin: 8px 0;"><a href="#format-tests" class="text-primary">ğŸ“ æ ¼å¼æµ‹è¯•</a></li>
                <li style="margin: 8px 0;"><a href="#performance-tests" class="text-primary">âš¡ æ€§èƒ½æµ‹è¯•</a></li>
                <li style="margin: 8px 0;"><a href="#automated-tests" class="text-primary">ğŸ¤– è‡ªåŠ¨åŒ–æµ‹è¯•</a></li>
                <li style="margin: 8px 0;"><a href="#troubleshooting-tests" class="text-primary">ğŸ” æ•…éšœè¯Šæ–­</a></li>
            </ul>
        </div>

        <!-- å¿«é€Ÿæµ‹è¯• -->
        <div class="card" id="quick-tests">
            <h2>âš¡ å¿«é€Ÿæµ‹è¯•</h2>
            <p>è¿™äº›æµ‹è¯•å¯ä»¥å¿«é€ŸéªŒè¯ç³»ç»Ÿçš„åŸºæœ¬åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚</p>
            
            <div class="grid">
                <div class="card text-center" style="border-top: 4px solid var(--success-color);">
                    <h4>ğŸŒ åŸºç¡€æœåŠ¡æµ‹è¯•</h4>
                    <p>éªŒè¯WebæœåŠ¡å™¨å’Œæ ¸å¿ƒåŠŸèƒ½</p>
                    <a href="/" class="btn btn-success">è®¿é—®é¦–é¡µ</a>
                    <a href="/api/models" class="btn btn-primary">APIå¥åº·æ£€æŸ¥</a>
                </div>

                <div class="card text-center" style="border-top: 4px solid var(--primary-color);">
                    <h4>ğŸµ éŸ³é¢‘åˆ†ç¦»æµ‹è¯•</h4>
                    <p>ä½¿ç”¨ç¤ºä¾‹æ–‡ä»¶æµ‹è¯•åˆ†ç¦»åŠŸèƒ½</p>
                    <a href="#" class="btn btn-primary" onclick="testAudioSeparation()">å¼€å§‹æµ‹è¯•</a>
                </div>

                <div class="card text-center" style="border-top: 4px solid var(--info-color);">
                    <h4>ğŸ”— MCPåè®®æµ‹è¯•</h4>
                    <p>éªŒè¯MCPæ¥å£åŠŸèƒ½</p>
                    <a href="/test/mcp" class="btn btn-info">MCPæµ‹è¯•é¡µé¢</a>
                </div>

                <div class="card text-center" style="border-top: 4px solid var(--warning-color);">
                    <h4>ğŸ“ æ ¼å¼æ”¯æŒæµ‹è¯•</h4>
                    <p>æµ‹è¯•æ–°å¢çš„æ ¼å¼å’Œè´¨é‡åŠŸèƒ½</p>
                    <a href="#" class="btn btn-warning" onclick="testFormats()">æµ‹è¯•æ ¼å¼</a>
                </div>
            </div>
        </div>

        <!-- APIæµ‹è¯• -->
        <div class="card" id="api-tests">
            <h2>ğŸ”§ APIæ¥å£æµ‹è¯•</h2>
            <p>è¯¦ç»†æµ‹è¯•æ‰€æœ‰REST APIç«¯ç‚¹çš„åŠŸèƒ½ã€‚</p>
            
            <h3>åŸºç¡€APIæµ‹è¯•</h3>
            <div class="grid grid-2">
                <div class="test-section">
                    <h4>æ¨¡å‹API</h4>
                    <p>æµ‹è¯•æ¨¡å‹åˆ—è¡¨è·å–åŠŸèƒ½</p>
                    <button class="btn btn-primary w-100" onclick="testModelsAPI()">æµ‹è¯• GET /api/models</button>
                    <div id="modelsResult" class="output"></div>
                </div>

                <div class="test-section">
                    <h4>æ ¼å¼API <span class="badge new">æ–°åŠŸèƒ½</span></h4>
                    <p>æµ‹è¯•æ”¯æŒæ ¼å¼è·å–åŠŸèƒ½</p>
                    <button class="btn btn-primary w-100" onclick="testFormatsAPI()">æµ‹è¯• GET /api/formats</button>
                    <div id="formatsResult" class="output"></div>
                </div>

                <div class="test-section">
                    <h4>è´¨é‡API <span class="badge new">æ–°åŠŸèƒ½</span></h4>
                    <p>æµ‹è¯•éŸ³è´¨é€‰é¡¹è·å–åŠŸèƒ½</p>
                    <button class="btn btn-primary w-100" onclick="testQualitiesAPI()">æµ‹è¯• GET /api/qualities</button>
                    <div id="qualitiesResult" class="output"></div>
                </div>

                <div class="test-section">
                    <h4>å¥åº·æ£€æŸ¥</h4>
                    <p>æµ‹è¯•æœåŠ¡å™¨å¥åº·çŠ¶æ€</p>
                    <button class="btn btn-success w-100" onclick="testHealthAPI()">æµ‹è¯• GET /health</button>
                    <div id="healthResult" class="output"></div>
                </div>
            </div>

            <h3>å¤„ç†APIæµ‹è¯•</h3>
            <div class="warning-box">
                <h4>âš ï¸ æ³¨æ„</h4>
                <p>ä»¥ä¸‹æµ‹è¯•éœ€è¦å®é™…çš„éŸ³é¢‘æ–‡ä»¶ã€‚è¯·ç¡®ä¿æµ‹è¯•æ–‡ä»¶å­˜åœ¨äº <code>test/</code> ç›®å½•ã€‚</p>
            </div>

            <div class="grid">
                <div class="test-section">
                    <h4>åŸºç¡€éŸ³é¢‘å¤„ç†</h4>
                    <button class="btn btn-primary" onclick="testBasicProcessing()">æµ‹è¯•åŸºç¡€å¤„ç†</button>
                    <div id="basicProcessResult" class="output"></div>
                </div>

                <div class="test-section">
                    <h4>æ ¼å¼ä¸è´¨é‡å¤„ç† <span class="badge updated">å·²å‡çº§</span></h4>
                    <button class="btn btn-accent" onclick="testFormatQualityProcessing()">æµ‹è¯•æ ¼å¼è´¨é‡</button>
                    <div id="formatQualityResult" class="output"></div>
                </div>
            </div>
        </div>

        <!-- MCPæµ‹è¯• -->
        <div class="card" id="mcp-tests">
            <h2>ğŸ”— MCPåè®®æµ‹è¯•</h2>
            <p>æµ‹è¯•MCP (Model Context Protocol) åŠŸèƒ½çš„å®Œæ•´æ€§ã€‚</p>

            <div class="info-box">
                <h4>ğŸ¯ MCPæµ‹è¯•èŒƒå›´</h4>
                <ul>
                    <li>JSON-RPC 2.0åè®®å…¼å®¹æ€§</li>
                    <li>å·¥å…·è°ƒç”¨å’Œå“åº”</li>
                    <li>å®æ—¶è¿›åº¦æµï¼ˆSSEï¼‰</li>
                    <li>é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æƒ…å†µ</li>
                </ul>
            </div>

            <div class="grid">
                <div class="test-section">
                    <h4>åè®®åˆå§‹åŒ–</h4>
                    <button class="btn btn-primary" onclick="testMCPInitialize()">æµ‹è¯•åˆå§‹åŒ–</button>
                    <div id="mcpInitResult" class="output"></div>
                </div>

                <div class="test-section">
                    <h4>å·¥å…·åˆ—è¡¨</h4>
                    <button class="btn btn-primary" onclick="testMCPTools()">æµ‹è¯•å·¥å…·åˆ—è¡¨</button>
                    <div id="mcpToolsResult" class="output"></div>
                </div>

                <div class="test-section">
                    <h4>éŸ³é¢‘åˆ†ç¦»å·¥å…·</h4>
                    <button class="btn btn-success" onclick="testMCPSeparation()">æµ‹è¯•åˆ†ç¦»å·¥å…·</button>
                    <div id="mcpSeparationResult" class="output"></div>
                </div>

                <div class="test-section">
                    <h4>SSEæµæµ‹è¯•</h4>
                    <button class="btn btn-info" onclick="testMCPStream()">æµ‹è¯•å®æ—¶æµ</button>
                    <div id="mcpStreamResult" class="output"></div>
                </div>
            </div>

            <div class="text-center mt-3">
                <a href="/test/mcp" class="btn btn-accent btn-lg">è®¿é—®äº¤äº’å¼MCPæµ‹è¯•é¡µé¢</a>
            </div>
        </div>

        <!-- æ ¼å¼æµ‹è¯• -->
        <div class="card" id="format-tests">
            <h2>ğŸ“ æ ¼å¼ä¸è´¨é‡æµ‹è¯•</h2>
            <p>æµ‹è¯•æ–°å¢çš„è¾“å‡ºæ ¼å¼å’ŒéŸ³è´¨æ§åˆ¶åŠŸèƒ½ã€‚</p>

            <h3>æ”¯æŒæ ¼å¼æµ‹è¯•</h3>
            <div class="grid grid-3">
                <div class="card card-primary">
                    <div class="card-header">
                        <h5>WAVæ ¼å¼æµ‹è¯•</h5>
                    </div>
                    <div class="card-body">
                        <p>æµ‹è¯•WAVæ— æŸè¾“å‡º</p>
                        <button class="btn btn-primary btn-sm" onclick="testWAVFormat()">æµ‹è¯•WAV</button>
                        <div id="wavResult" class="mt-2" style="font-size: 0.9em;"></div>
                    </div>
                </div>

                <div class="card card-success">
                    <div class="card-header">
                        <h5>MP3æ ¼å¼æµ‹è¯•</h5>
                    </div>
                    <div class="card-body">
                        <p>æµ‹è¯•MP3å‹ç¼©è¾“å‡º</p>
                        <button class="btn btn-success btn-sm" onclick="testMP3Format()">æµ‹è¯•MP3</button>
                        <div id="mp3Result" class="mt-2" style="font-size: 0.9em;"></div>
                    </div>
                </div>

                <div class="card card-warning">
                    <div class="card-header">
                        <h5>FLACæ ¼å¼æµ‹è¯•</h5>
                    </div>
                    <div class="card-body">
                        <p>æµ‹è¯•FLACæ— æŸå‹ç¼©</p>
                        <button class="btn btn-warning btn-sm" onclick="testFLACFormat()">æµ‹è¯•FLAC</button>
                        <div id="flacResult" class="mt-2" style="font-size: 0.9em;"></div>
                    </div>
                </div>
            </div>

            <h3>éŸ³è´¨é€‰é¡¹æµ‹è¯•</h3>
            <table class="table table-striped">
                <thead>
                    <tr>
                        <th>è´¨é‡ç­‰çº§</th>
                        <th>æè¿°</th>
                        <th>æµ‹è¯•æ“ä½œ</th>
                        <th>çŠ¶æ€</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>lossless</strong></td>
                        <td>æ— æŸè´¨é‡</td>
                        <td><button class="btn btn-sm btn-primary" onclick="testQuality('lossless')">æµ‹è¯•</button></td>
                        <td><span id="losslessStatus">å¾…æµ‹è¯•</span></td>
                    </tr>
                    <tr>
                        <td><strong>high</strong></td>
                        <td>é«˜è´¨é‡ (320kbps)</td>
                        <td><button class="btn btn-sm btn-primary" onclick="testQuality('high')">æµ‹è¯•</button></td>
                        <td><span id="highStatus">å¾…æµ‹è¯•</span></td>
                    </tr>
                    <tr>
                        <td><strong>medium</strong></td>
                        <td>ä¸­ç­‰è´¨é‡ (192kbps)</td>
                        <td><button class="btn btn-sm btn-primary" onclick="testQuality('medium')">æµ‹è¯•</button></td>
                        <td><span id="mediumStatus">å¾…æµ‹è¯•</span></td>
                    </tr>
                    <tr>
                        <td><strong>low</strong></td>
                        <td>ä½è´¨é‡ (128kbps)</td>
                        <td><button class="btn btn-sm btn-primary" onclick="testQuality('low')">æµ‹è¯•</button></td>
                        <td><span id="lowStatus">å¾…æµ‹è¯•</span></td>
                    </tr>
                </tbody>
            </table>

            <div class="tip">
                <strong>ğŸ’¡ æµ‹è¯•æç¤ºï¼š</strong> æ ¼å¼å’Œè´¨é‡æµ‹è¯•ä¼šåˆ›å»ºå®é™…çš„éŸ³é¢‘åˆ†ç¦»ä»»åŠ¡ã€‚
                è¯·ç¡®ä¿æœ‰æµ‹è¯•éŸ³é¢‘æ–‡ä»¶ï¼Œå¹¶æ³¨æ„æµ‹è¯•æ—¶é—´å¯èƒ½è¾ƒé•¿ã€‚
            </div>
        </div>

        <!-- æ€§èƒ½æµ‹è¯• -->
        <div class="card" id="performance-tests">
            <h2>âš¡ æ€§èƒ½æµ‹è¯•</h2>
            <p>æµ‹è¯•ç³»ç»Ÿåœ¨ä¸åŒè´Ÿè½½ä¸‹çš„æ€§èƒ½è¡¨ç°ã€‚</p>

            <div class="warning-box">
                <h4>âš ï¸ æ€§èƒ½æµ‹è¯•è¯´æ˜</h4>
                <p>ä»¥ä¸‹æµ‹è¯•å¯èƒ½ä¼šå¯¹æœåŠ¡å™¨é€ æˆè¾ƒé«˜è´Ÿè½½ï¼Œè¯·åœ¨é€‚å½“çš„æ—¶å€™è¿è¡Œã€‚</p>
            </div>

            <div class="grid">
                <div class="test-section">
                    <h4>å¹¶å‘è¯·æ±‚æµ‹è¯•</h4>
                    <p>æµ‹è¯•ç³»ç»Ÿå¤„ç†å¤šä¸ªåŒæ—¶è¯·æ±‚çš„èƒ½åŠ›</p>
                    <button class="btn btn-warning" onclick="testConcurrentRequests()">æµ‹è¯•å¹¶å‘</button>
                    <div id="concurrentResult" class="output"></div>
                </div>

                <div class="test-section">
                    <h4>å¤§æ–‡ä»¶å¤„ç†æµ‹è¯•</h4>
                    <p>æµ‹è¯•å¤§å°ºå¯¸éŸ³é¢‘æ–‡ä»¶çš„å¤„ç†èƒ½åŠ›</p>
                    <button class="btn btn-warning" onclick="testLargeFile()">æµ‹è¯•å¤§æ–‡ä»¶</button>
                    <div id="largeFileResult" class="output"></div>
                </div>

                <div class="test-section">
                    <h4>å†…å­˜ä½¿ç”¨æµ‹è¯•</h4>
                    <p>ç›‘æ§å¤„ç†è¿‡ç¨‹ä¸­çš„å†…å­˜ä½¿ç”¨æƒ…å†µ</p>
                    <button class="btn btn-info" onclick="testMemoryUsage()">ç›‘æ§å†…å­˜</button>
                    <div id="memoryResult" class="output"></div>
                </div>

                <div class="test-section">
                    <h4>å“åº”æ—¶é—´æµ‹è¯•</h4>
                    <p>æµ‹è¯•å„APIç«¯ç‚¹çš„å“åº”æ—¶é—´</p>
                    <button class="btn btn-info" onclick="testResponseTime()">æµ‹è¯•å“åº”</button>
                    <div id="responseTimeResult" class="output"></div>
                </div>
            </div>
        </div>

        <!-- è‡ªåŠ¨åŒ–æµ‹è¯• -->
        <div class="card" id="automated-tests">
            <h2>ğŸ¤– è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬</h2>
            <p>æä¾›è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼Œç”¨äºCI/CDå’Œå®šæœŸæ£€æŸ¥ã€‚</p>

            <div class="grid">
                <div class="card" style="background: #f8f9fa;">
                    <h4>åŸºç¡€åŠŸèƒ½æµ‹è¯•</h4>
                    <p>å¿«é€ŸéªŒè¯æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½</p>
                    <pre><code># åœ¨é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
python test/test_basic_functionality.py</code></pre>
                    <button class="btn btn-success" onclick="runBasicTests()">è¿è¡ŒåŸºç¡€æµ‹è¯•</button>
                </div>

                <div class="card" style="background: #f8f9fa;">
                    <h4>APIå®Œæ•´æ€§æµ‹è¯•</h4>
                    <p>æµ‹è¯•æ‰€æœ‰APIç«¯ç‚¹çš„å®Œæ•´æ€§</p>
                    <pre><code># æµ‹è¯•æ‰€æœ‰APIç«¯ç‚¹
python test/test_api_endpoints.py</code></pre>
                    <button class="btn btn-primary" onclick="runAPITests()">è¿è¡ŒAPIæµ‹è¯•</button>
                </div>

                <div class="card" style="background: #f8f9fa;">
                    <h4>æ ¼å¼è´¨é‡å¿«é€Ÿæµ‹è¯•</h4>
                    <p>å¿«é€Ÿæµ‹è¯•éŸ³é¢‘æ ¼å¼å’Œè´¨é‡åŠŸèƒ½</p>
                    <pre><code># å¿«é€Ÿæ ¼å¼æµ‹è¯•ï¼ˆè·³è¿‡è€—æ—¶çš„FLACæµ‹è¯•ï¼‰
python test_format_quality_quick.py</code></pre>
                    <button class="btn btn-accent" onclick="runFormatTests()">è¿è¡Œæ ¼å¼æµ‹è¯•</button>
                </div>

                <div class="card" style="background: #f8f9fa;">
                    <h4>MCPåè®®æµ‹è¯•</h4>
                    <p>å®Œæ•´çš„MCPåè®®åŠŸèƒ½æµ‹è¯•</p>
                    <pre><code># æµ‹è¯•MCPåè®®åŠŸèƒ½
python test/test_mcp_protocol.py</code></pre>
                    <button class="btn btn-info" onclick="runMCPTests()">è¿è¡ŒMCPæµ‹è¯•</button>
                </div>
            </div>

            <div class="highlight-box">
                <h4>ğŸ”„ æŒç»­é›†æˆé…ç½®</h4>
                <p>ä¸ºCI/CDç¯å¢ƒé…ç½®è‡ªåŠ¨åŒ–æµ‹è¯•ï¼š</p>
                <pre><code># GitHub Actions é…ç½®ç¤ºä¾‹
name: Test Demucs Service
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Setup Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.8'
      - name: Install dependencies
        run: pip install -r requirements.txt
      - name: Run tests
        run: python test/run_all_tests.py</code></pre>
            </div>
        </div>

        <!-- æ•…éšœè¯Šæ–­ -->
        <div class="card" id="troubleshooting-tests">
            <h2>ğŸ” æ•…éšœè¯Šæ–­æµ‹è¯•</h2>
            <p>å½“ç³»ç»Ÿå‡ºç°é—®é¢˜æ—¶ï¼Œä½¿ç”¨è¿™äº›æµ‹è¯•æ¥å®šä½å’Œè¯Šæ–­é—®é¢˜ã€‚</p>

            <div class="grid">
                <div class="test-section">
                    <h4>ç³»ç»Ÿç»„ä»¶æ£€æŸ¥</h4>
                    <button class="btn btn-primary" onclick="checkSystemComponents()">æ£€æŸ¥ç»„ä»¶</button>
                    <div id="systemCheck" class="output"></div>
                </div>

                <div class="test-section">
                    <h4>ç½‘ç»œè¿æ¥æµ‹è¯•</h4>
                    <button class="btn btn-primary" onclick="testNetworkConnectivity()">æµ‹è¯•ç½‘ç»œ</button>
                    <div id="networkCheck" class="output"></div>
                </div>

                <div class="test-section">
                    <h4>ä¾èµ–åº“æ£€æŸ¥</h4>
                    <button class="btn btn-info" onclick="checkDependencies()">æ£€æŸ¥ä¾èµ–</button>
                    <div id="dependencyCheck" class="output"></div>
                </div>

                <div class="test-section">
                    <h4>æ—¥å¿—åˆ†æ</h4>
                    <button class="btn btn-warning" onclick="analyzeLogs()">åˆ†ææ—¥å¿—</button>
                    <div id="logAnalysis" class="output"></div>
                </div>
            </div>

            <div class="error-box">
                <h4>ğŸš¨ å¸¸è§é—®é¢˜è¯Šæ–­</h4>
                <ul>
                    <li><strong>ä¸Šä¼ å¤±è´¥</strong>ï¼šæ£€æŸ¥æ–‡ä»¶å¤§å°é™åˆ¶å’Œæ ¼å¼æ”¯æŒ</li>
                    <li><strong>å¤„ç†è¶…æ—¶</strong>ï¼šæ£€æŸ¥æœåŠ¡å™¨èµ„æºå’Œæ¨¡å‹åŠ è½½çŠ¶æ€</li>
                    <li><strong>APIé”™è¯¯</strong>ï¼šæ£€æŸ¥æœåŠ¡å™¨å¯åŠ¨çŠ¶æ€å’Œç«¯å£é…ç½®</li>
                    <li><strong>MCPè¿æ¥é—®é¢˜</strong>ï¼šæ£€æŸ¥JSON-RPCåè®®å…¼å®¹æ€§</li>
                </ul>
            </div>
        </div>

        <!-- æµ‹è¯•æŠ¥å‘Š -->
        <div class="card">
            <h2>ğŸ“Š æµ‹è¯•æŠ¥å‘Š</h2>
            <p>å®æ—¶æµ‹è¯•ç»“æœæ±‡æ€»å’Œç³»ç»ŸçŠ¶æ€æ¦‚è§ˆã€‚</p>

            <div class="grid grid-2">
                <div class="card card-info">
                    <div class="card-header">
                        <h5>æµ‹è¯•æ¦‚å†µ</h5>
                    </div>
                    <div class="card-body">
                        <div id="testSummary">
                            <p>æ€»æµ‹è¯•æ•°: <span id="totalTests">0</span></p>
                            <p>æˆåŠŸ: <span id="passedTests" class="text-success">0</span></p>
                            <p>å¤±è´¥: <span id="failedTests" class="text-danger">0</span></p>
                            <p>è·³è¿‡: <span id="skippedTests" class="text-warning">0</span></p>
                        </div>
                    </div>
                </div>

                <div class="card card-primary">
                    <div class="card-header">
                        <h5>ç³»ç»ŸçŠ¶æ€</h5>
                    </div>
                    <div class="card-body">
                        <div id="systemStatus">
                            <p>WebæœåŠ¡: <span id="webStatus" class="badge">æ£€æŸ¥ä¸­...</span></p>
                            <p>APIæœåŠ¡: <span id="apiStatus" class="badge">æ£€æŸ¥ä¸­...</span></p>
                            <p>MCPæœåŠ¡: <span id="mcpStatus" class="badge">æ£€æŸ¥ä¸­...</span></p>
                            <p>å¤„ç†æœåŠ¡: <span id="processStatus" class="badge">æ£€æŸ¥ä¸­...</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-center mt-3">
                <button class="btn btn-success btn-lg" onclick="runAllTests()">ğŸ§ª è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
                <button class="btn btn-primary btn-lg ml-2" onclick="generateReport()">ğŸ“‹ ç”ŸæˆæŠ¥å‘Š</button>
                <button class="btn btn-secondary btn-lg ml-2" onclick="clearResults()">ğŸ—‘ï¸ æ¸…ç©ºç»“æœ</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>DemucséŸ³é¢‘åˆ†ç¦»å·¥å…· &copy; 2024 | åŸºäº<a href="https://github.com/facebookresearch/demucs" style="color: white; text-decoration: underline;">Demucs</a>å¼€å‘</p>
        </div>
    </footer>

    <!-- JavaScriptæ–‡ä»¶ -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script>
        // æµ‹è¯•è®¡æ•°å™¨
        let testStats = {
            total: 0,
            passed: 0,
            failed: 0,
            skipped: 0
        };

        // æ›´æ–°æµ‹è¯•ç»Ÿè®¡
        function updateTestStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('passedTests').textContent = testStats.passed;
            document.getElementById('failedTests').textContent = testStats.failed;
            document.getElementById('skippedTests').textContent = testStats.skipped;
        }

        // è®°å½•æµ‹è¯•ç»“æœ
        function recordTestResult(success) {
            testStats.total++;
            if (success) {
                testStats.passed++;
            } else {
                testStats.failed++;
            }
            updateTestStats();
        }

        // APIæµ‹è¯•å‡½æ•°
        async function testModelsAPI() {
            const resultDiv = document.getElementById('modelsResult');
            resultDiv.innerHTML = 'æ­£åœ¨æµ‹è¯•...';
            
            try {
                const response = await fetch('/api/models');
                const data = await response.json();
                resultDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                resultDiv.className = 'output alert alert-success';
                recordTestResult(true);
            } catch (error) {
                resultDiv.innerHTML = `é”™è¯¯: ${error.message}`;
                resultDiv.className = 'output alert alert-error';
                recordTestResult(false);
            }
        }

        async function testFormatsAPI() {
            const resultDiv = document.getElementById('formatsResult');
            resultDiv.innerHTML = 'æ­£åœ¨æµ‹è¯•...';
            
            try {
                const response = await fetch('/api/formats');
                const data = await response.json();
                resultDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                resultDiv.className = 'output alert alert-success';
                recordTestResult(true);
            } catch (error) {
                resultDiv.innerHTML = `é”™è¯¯: ${error.message}`;
                resultDiv.className = 'output alert alert-error';
                recordTestResult(false);
            }
        }

        async function testQualitiesAPI() {
            const resultDiv = document.getElementById('qualitiesResult');
            resultDiv.innerHTML = 'æ­£åœ¨æµ‹è¯•...';
            
            try {
                const response = await fetch('/api/qualities');
                const data = await response.json();
                resultDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                resultDiv.className = 'output alert alert-success';
                recordTestResult(true);
            } catch (error) {
                resultDiv.innerHTML = `é”™è¯¯: ${error.message}`;
                resultDiv.className = 'output alert alert-error';
                recordTestResult(false);
            }
        }

        async function testHealthAPI() {
            const resultDiv = document.getElementById('healthResult');
            resultDiv.innerHTML = 'æ­£åœ¨æµ‹è¯•...';
            
            try {
                const response = await fetch('/health');
                const data = await response.json();
                resultDiv.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                resultDiv.className = 'output alert alert-success';
                recordTestResult(true);
            } catch (error) {
                resultDiv.innerHTML = `é”™è¯¯: ${error.message}`;
                resultDiv.className = 'output alert alert-error';
                recordTestResult(false);
            }
        }

        // å¿«é€Ÿç³»ç»ŸçŠ¶æ€æ£€æŸ¥
        async function checkSystemStatus() {
            const status = {
                web: document.getElementById('webStatus'),
                api: document.getElementById('apiStatus'),
                mcp: document.getElementById('mcpStatus'),
                process: document.getElementById('processStatus')
            };

            // æ£€æŸ¥WebæœåŠ¡
            try {
                await fetch('/');
                status.web.textContent = 'æ­£å¸¸';
                status.web.className = 'badge badge-success';
            } catch (error) {
                status.web.textContent = 'å¼‚å¸¸';
                status.web.className = 'badge badge-danger';
            }

            // æ£€æŸ¥APIæœåŠ¡
            try {
                await fetch('/api/models');
                status.api.textContent = 'æ­£å¸¸';
                status.api.className = 'badge badge-success';
            } catch (error) {
                status.api.textContent = 'å¼‚å¸¸';
                status.api.className = 'badge badge-danger';
            }

            // æ£€æŸ¥MCPæœåŠ¡
            try {
                await fetch('/mcp', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: '{}' });
                status.mcp.textContent = 'æ­£å¸¸';
                status.mcp.className = 'badge badge-success';
            } catch (error) {
                status.mcp.textContent = 'å¼‚å¸¸';
                status.mcp.className = 'badge badge-danger';
            }

            // æ£€æŸ¥å¤„ç†æœåŠ¡ï¼ˆé€šè¿‡å¥åº·æ£€æŸ¥ï¼‰
            try {
                const response = await fetch('/health');
                const data = await response.json();
                if (data.status === 'healthy') {
                    status.process.textContent = 'æ­£å¸¸';
                    status.process.className = 'badge badge-success';
                } else {
                    status.process.textContent = 'è­¦å‘Š';
                    status.process.className = 'badge badge-warning';
                }
            } catch (error) {
                status.process.textContent = 'å¼‚å¸¸';
                status.process.className = 'badge badge-danger';
            }
        }

        // è¿è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            window.showMessage('å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...', 'info');
            
            // é‡ç½®ç»Ÿè®¡
            testStats = { total: 0, passed: 0, failed: 0, skipped: 0 };
            updateTestStats();
            
            // ä¾æ¬¡è¿è¡Œæµ‹è¯•
            await testModelsAPI();
            await testFormatsAPI();
            await testQualitiesAPI();
            await testHealthAPI();
            
            window.showMessage(`æµ‹è¯•å®Œæˆï¼é€šè¿‡: ${testStats.passed}, å¤±è´¥: ${testStats.failed}`, 
                testStats.failed === 0 ? 'success' : 'warning');
        }

        // æ¸…ç©ºç»“æœ
        function clearResults() {
            const outputs = document.querySelectorAll('.output');
            outputs.forEach(output => {
                output.innerHTML = '';
                output.className = 'output';
            });
            
            testStats = { total: 0, passed: 0, failed: 0, skipped: 0 };
            updateTestStats();
            
            window.showMessage('æµ‹è¯•ç»“æœå·²æ¸…ç©º', 'info');
        }

        // ç”ŸæˆæŠ¥å‘Š
        function generateReport() {
            const report = {
                timestamp: new Date().toISOString(),
                stats: testStats,
                system: {
                    userAgent: navigator.userAgent,
                    timestamp: Date.now()
                }
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `demucs-test-report-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            window.showMessage('æµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ', 'success');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        document.addEventListener('DOMContentLoaded', function() {
            checkSystemStatus();
        });

        // å ä½ç¬¦å‡½æ•°ï¼ˆåœ¨å®é™…ä½¿ç”¨ä¸­éœ€è¦å®ç°ï¼‰
        function testAudioSeparation() { window.showMessage('éŸ³é¢‘åˆ†ç¦»æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testFormats() { window.showMessage('æ ¼å¼æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testBasicProcessing() { window.showMessage('åŸºç¡€å¤„ç†æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testFormatQualityProcessing() { window.showMessage('æ ¼å¼è´¨é‡æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testMCPInitialize() { window.showMessage('MCPåˆå§‹åŒ–æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testMCPTools() { window.showMessage('MCPå·¥å…·æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testMCPSeparation() { window.showMessage('MCPåˆ†ç¦»æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testMCPStream() { window.showMessage('MCPæµæµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testWAVFormat() { window.showMessage('WAVæ ¼å¼æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testMP3Format() { window.showMessage('MP3æ ¼å¼æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testFLACFormat() { window.showMessage('FLACæ ¼å¼æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testQuality(quality) { window.showMessage(`${quality}è´¨é‡æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...`, 'info'); }
        function testConcurrentRequests() { window.showMessage('å¹¶å‘æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testLargeFile() { window.showMessage('å¤§æ–‡ä»¶æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testMemoryUsage() { window.showMessage('å†…å­˜æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testResponseTime() { window.showMessage('å“åº”æ—¶é—´æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function runBasicTests() { window.showMessage('åŸºç¡€æµ‹è¯•è¿è¡ŒåŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function runAPITests() { window.showMessage('APIæµ‹è¯•è¿è¡ŒåŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function runFormatTests() { window.showMessage('æ ¼å¼æµ‹è¯•è¿è¡ŒåŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function runMCPTests() { window.showMessage('MCPæµ‹è¯•è¿è¡ŒåŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function checkSystemComponents() { window.showMessage('ç³»ç»Ÿç»„ä»¶æ£€æŸ¥åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function testNetworkConnectivity() { window.showMessage('ç½‘ç»œè¿æ¥æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function checkDependencies() { window.showMessage('ä¾èµ–æ£€æŸ¥åŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
        function analyzeLogs() { window.showMessage('æ—¥å¿—åˆ†æåŠŸèƒ½å¼€å‘ä¸­...', 'info'); }
    </script>
</body>
</html> 