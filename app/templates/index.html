<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demucs éŸ³é¢‘åˆ†ç¦»å·¥å…·</title>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --bg-color: #f9f9f9;
            --text-color: #333;
            --code-bg: #f0f4f8;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0;
            padding: 0; 
            line-height: 1.6;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 2rem 0;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        h1 { 
            margin: 0;
            font-size: 2.5rem;
        }
        
        h2 { 
            color: var(--secondary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 0.5rem;
            margin-top: 2rem;
        }
        
        h3 {
            color: var(--secondary-color);
        }
        
        code { 
            background-color: var(--code-bg); 
            padding: 2px 5px; 
            border-radius: 3px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9em;
        }
        
        pre { 
            background-color: var(--code-bg);
            padding: 15px; 
            border-radius: var(--border-radius);
            overflow-x: auto;
            border-left: 4px solid var(--primary-color);
        }
        
        .container { 
            max-width: 900px; 
            margin: 0 auto;
            padding: 0 20px 40px;
        }
        
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .upload-area {
            border: 2px dashed var(--primary-color);
            padding: 30px;
            text-align: center;
            border-radius: var(--border-radius);
            background: rgba(52, 152, 219, 0.05);
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            background: rgba(52, 152, 219, 0.1);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        select, input[type="file"] {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        
        button:hover {
            background-color: #2980b9;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .progress-container {
            margin-top: 20px;
            display: none;
        }
        
        .progress-bar {
            height: 20px;
            background-color: #eee;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--primary-color);
            width: 0%;
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            font-weight: bold;
        }
        
        .status-message {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .download-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background-color: #28a745;
            color: white;
            text-decoration: none;
            border-radius: 4px;
        }
        
        .download-link:hover {
            background-color: #218838;
        }
        
        .info-section {
            margin-top: 40px;
        }
        
        .model-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .model-card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            padding: 20px;
            border-top: 4px solid var(--primary-color);
        }
        
        .model-name {
            font-weight: bold;
            font-size: 1.2em;
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        
        .badge {
            display: inline-block;
            font-size: 0.8em;
            background: #e8f4fd;
            color: var(--primary-color);
            padding: 3px 8px;
            border-radius: 12px;
            margin-right: 5px;
        }
        
        .tip {
            background-color: #fff3cd;
            color: #856404;
            padding: 10px 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        
        footer {
            background-color: var(--secondary-color);
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-top: 40px;
        }
        
        .main-nav {
            display: flex;
            justify-content: center;
            margin-top: 1rem;
        }
        
        .nav-link {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            margin: 0 0.5rem;
        }
        
        .nav-link:hover {
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸµ Demucs éŸ³é¢‘åˆ†ç¦»å·¥å…· + æ ‡å‡†MCPæœåŠ¡å™¨</h1>
            <p>åŸºäºæ·±åº¦å­¦ä¹ çš„é«˜è´¨é‡éŸ³é¢‘æºåˆ†ç¦»ç³»ç»Ÿï¼Œå®Œå…¨æ”¯æŒæ ‡å‡† <strong>MCP (Model Context Protocol)</strong> åè®®</p>
            <div class="main-nav">
                <a href="#main-content" class="nav-link">é¦–é¡µ</a>
                <a href="/test/mcp" class="nav-link">ğŸ”— MCPæµ‹è¯•</a>
                <a href="#mcp-info" class="nav-link">ğŸ“‹ MCPåè®®</a>
                <a href="#api-docs" class="nav-link">APIæ–‡æ¡£</a>
                <a href="#api-flow" class="nav-link">æ¥å£è°ƒç”¨æµç¨‹</a>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div id="main-content">
            <div class="card">
                <h2>ğŸµ DemucséŸ³é¢‘åˆ†ç¦»å·¥å…·</h2>
                <p>æ¬¢è¿ä½¿ç”¨DemucséŸ³é¢‘åˆ†ç¦»å·¥å…·ï¼è¿™ä¸ªåº”ç”¨å¯ä»¥å°†æ··åˆéŸ³é¢‘åˆ†ç¦»æˆç‹¬ç«‹çš„éŸ³è½¨ï¼Œå¦‚äººå£°ã€é¼“å£°ã€è´æ–¯å’Œå…¶ä»–ä¹å™¨ã€‚</p>
                <p>ğŸ”— <strong>æ–°ç‰¹æ€§ï¼š</strong>æœ¬åº”ç”¨ç°åœ¨å®Œå…¨æ”¯æŒæ ‡å‡† <strong>MCP (Model Context Protocol)</strong> åè®®ï¼Œå¯ä¸Claude Desktopã€Cursorç­‰MCPå®¢æˆ·ç«¯æ— ç¼é›†æˆï¼</p>
                <p>ä½¿ç”¨ä¸‹é¢çš„è¡¨å•ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶ï¼Œé€‰æ‹©æ¨¡å‹å’Œè¦åˆ†ç¦»çš„éŸ³è½¨ï¼Œç„¶åç‚¹å‡»"å¼€å§‹åˆ†ç¦»"æŒ‰é’®ã€‚</p>
                
                <div style="text-align: center; margin: 20px 0;">
                    <a href="/test/mcp" style="display: inline-block; background: #007aff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px; margin: 0 10px;">
                        ğŸ§ª MCPåè®®æµ‹è¯•
                    </a>
                    <a href="#mcp-info" style="display: inline-block; background: #28a745; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px; margin: 0 10px;">
                        ğŸ“‹ æŸ¥çœ‹MCPä¿¡æ¯
                    </a>
                </div>
            </div>
            
            <!-- ä¸Šä¼ å’Œå¤„ç†è¡¨å• -->
            <form id="separationForm" class="card">
                <div class="upload-area" id="dropArea">
                    <p>å°†éŸ³é¢‘æ–‡ä»¶æ‹–æ”¾åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>
                    <input type="file" id="audioFile" name="file" accept=".mp3,.wav,.flac,.ogg,.m4a" style="display: none;">
                </div>
                
                <div class="form-group">
                    <label for="modelSelect">åˆ†ç¦»æ¨¡å‹ï¼š</label>
                    <select id="modelSelect" name="model">
                        <option value="htdemucs" selected>htdemucs (é»˜è®¤æ¨¡å‹ï¼Œå¹³è¡¡è´¨é‡å’Œé€Ÿåº¦)</option>
                        <option value="htdemucs_ft">htdemucs_ft (é«˜è´¨é‡ï¼Œé€Ÿåº¦è¾ƒæ…¢)</option>
                        <option value="htdemucs_6s">htdemucs_6s (6éŸ³è½¨ï¼Œå«é’¢ç´å’Œå‰ä»–)</option>
                        <option value="mdx">mdx (å¹³è¡¡å‹)</option>
                        <option value="mdx_q">mdx_q (å¿«é€Ÿæ¨¡å‹)</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="stemsSelect">æå–éŸ³è½¨ï¼š</label>
                    <select id="stemsSelect" name="stems" multiple>
                        <option value="vocals" selected>äººå£° (Vocals)</option>
                        <option value="drums" selected>é¼“ç‚¹ (Drums)</option>
                        <option value="bass" selected>è´æ–¯ (Bass)</option>
                        <option value="other" selected>å…¶ä»–ä¹å™¨ (Other)</option>
                        <option value="piano">é’¢ç´ (Pianoï¼Œä»…htdemucs_6sæ”¯æŒ)</option>
                        <option value="guitar">å‰ä»– (Guitarï¼Œä»…htdemucs_6sæ”¯æŒ)</option>
                    </select>
                    <p><small>æŒ‰ä½Ctrlé”®(Macä¸Šä¸ºCommandé”®)å¯é€‰æ‹©å¤šä¸ªéŸ³è½¨</small></p>
                </div>
                
                <button type="submit" id="submitBtn" disabled>å¼€å§‹åˆ†ç¦»</button>
            </form>
            
            <div class="progress-container" id="progressContainer">
                <h3>å¤„ç†ä¸­...</h3>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="progress-text" id="progressText">0%</div>
                <div class="status-message" id="statusMessage"></div>
                <a href="#" class="download-link" id="downloadLink" style="display: none;">ä¸‹è½½åˆ†ç¦»åçš„éŸ³è½¨</a>
            </div>
        </div>
        
        <div class="info-section">
            <h2>å…³äºDemucséŸ³é¢‘åˆ†ç¦»æŠ€æœ¯</h2>
            <p>Demucsæ˜¯ç”±Facebook AI Researchå¼€å‘çš„å…ˆè¿›éŸ³é¢‘æºåˆ†ç¦»æ¨¡å‹ï¼Œèƒ½å¤Ÿå°†æ··åˆéŸ³é¢‘é«˜è´¨é‡åœ°åˆ†ç¦»ä¸ºä¸åŒçš„éŸ³è½¨ç»„ä»¶ã€‚</p>
            
            <h3>ä¸»è¦ç‰¹ç‚¹</h3>
            <ul>
                <li>åŸºäºæ·±åº¦å­¦ä¹ çš„éŸ³é¢‘æºåˆ†ç¦»</li>
                <li>æ”¯æŒå¤šç§åˆ†ç¦»æ¨¡å‹ï¼Œæ»¡è¶³ä¸åŒéœ€æ±‚</li>
                <li>å¯åˆ†ç¦»äººå£°ã€é¼“ç‚¹ã€è´æ–¯å’Œå…¶ä»–ä¹å™¨</li>
                <li>æ”¯æŒé«˜çº§6éŸ³è½¨æ¨¡å‹(å«é’¢ç´å’Œå‰ä»–)</li>
                <li>å®æ—¶æ˜¾ç¤ºå¤„ç†è¿›åº¦</li>
                <li>ç®€å•æ˜“ç”¨çš„Webç•Œé¢</li>
            </ul>
            
            <h3>å¯ç”¨æ¨¡å‹è¯´æ˜</h3>
            <div class="model-grid">
                <div class="model-card">
                    <div class="model-name">htdemucs <span class="badge">é»˜è®¤</span></div>
                    <p><strong>ç‰¹ç‚¹:</strong> Hybrid Transformer Demucsï¼Œæœ€æ–°çš„æ··åˆæ¶æ„æ¨¡å‹</p>
                    <p><strong>é€‚ç”¨åœºæ™¯:</strong> é«˜è´¨é‡åˆ†ç¦»ï¼Œå¹³è¡¡äº†è´¨é‡å’Œé€Ÿåº¦</p>
                    <p><strong>æ”¯æŒéŸ³è½¨:</strong> äººå£°ã€é¼“ç‚¹ã€è´æ–¯ã€å…¶ä»–ä¹å™¨</p>
                </div>
                
                <div class="model-card">
                    <div class="model-name">htdemucs_ft <span class="badge">é«˜è´¨é‡</span></div>
                    <p><strong>ç‰¹ç‚¹:</strong> htdemucsçš„å¾®è°ƒç‰ˆæœ¬ï¼Œæ›´å‡†ç¡®ä½†å¤„ç†é€Ÿåº¦æ›´æ…¢</p>
                    <p><strong>é€‚ç”¨åœºæ™¯:</strong> éœ€è¦æœ€é«˜è´¨é‡åˆ†ç¦»ï¼Œå¯¹é€Ÿåº¦è¦æ±‚ä¸é«˜</p>
                    <p><strong>æ”¯æŒéŸ³è½¨:</strong> äººå£°ã€é¼“ç‚¹ã€è´æ–¯ã€å…¶ä»–ä¹å™¨</p>
                </div>
                
                <div class="model-card">
                    <div class="model-name">htdemucs_6s <span class="badge">6éŸ³è½¨</span></div>
                    <p><strong>ç‰¹ç‚¹:</strong> 6éŸ³è½¨ç‰ˆæœ¬ï¼Œå¢åŠ äº†é’¢ç´å’Œå‰ä»–éŸ³è½¨</p>
                    <p><strong>é€‚ç”¨åœºæ™¯:</strong> éœ€è¦åˆ†ç¦»é’¢ç´å’Œå‰ä»–çš„åœºæ™¯</p>
                    <p><strong>æ”¯æŒéŸ³è½¨:</strong> äººå£°ã€é¼“ç‚¹ã€è´æ–¯ã€å…¶ä»–ä¹å™¨ã€é’¢ç´ã€å‰ä»–</p>
                </div>
                
                <div class="model-card">
                    <div class="model-name">mdx <span class="badge">å¹³è¡¡</span></div>
                    <p><strong>ç‰¹ç‚¹:</strong> ä»…åœ¨MusDB HQä¸Šè®­ç»ƒçš„æ¨¡å‹</p>
                    <p><strong>é€‚ç”¨åœºæ™¯:</strong> ä¸€èˆ¬ç”¨é€”ï¼Œæ€§èƒ½é€‚ä¸­</p>
                    <p><strong>æ”¯æŒéŸ³è½¨:</strong> äººå£°ã€é¼“ç‚¹ã€è´æ–¯ã€å…¶ä»–ä¹å™¨</p>
                </div>
                
                <div class="model-card">
                    <div class="model-name">mdx_q <span class="badge">å¿«é€Ÿ</span></div>
                    <p><strong>ç‰¹ç‚¹:</strong> mdxçš„é‡åŒ–ç‰ˆæœ¬ï¼Œä½“ç§¯æ›´å°ï¼Œå¤„ç†é€Ÿåº¦æ›´å¿«</p>
                    <p><strong>é€‚ç”¨åœºæ™¯:</strong> é€Ÿåº¦æ•æ„Ÿåœºæ™¯ï¼Œå¯¹è´¨é‡è¦æ±‚ä¸é«˜</p>
                    <p><strong>æ”¯æŒéŸ³è½¨:</strong> äººå£°ã€é¼“ç‚¹ã€è´æ–¯ã€å…¶ä»–ä¹å™¨</p>
                </div>
            </div>
            
            <h3>ä½¿ç”¨å»ºè®®</h3>
            <ul>
                <li>å¯¹äºå¤§å¤šæ•°ç”¨æˆ·ï¼Œæ¨èä½¿ç”¨é»˜è®¤çš„htdemucsæ¨¡å‹ï¼Œå®ƒæä¾›äº†è‰¯å¥½çš„å¹³è¡¡ã€‚</li>
                <li>å¦‚æœå¯¹åˆ†ç¦»è´¨é‡æœ‰æ›´é«˜è¦æ±‚ï¼Œå¯ä»¥å°è¯•htdemucs_ftæ¨¡å‹ã€‚</li>
                <li>å¦‚æœéœ€è¦åˆ†ç¦»é’¢ç´å’Œå‰ä»–ï¼Œè¯·é€‰æ‹©htdemucs_6sæ¨¡å‹ã€‚</li>
                <li>å¤„ç†å¤§å‹æ–‡ä»¶å¯èƒ½éœ€è¦è¾ƒé•¿æ—¶é—´ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨é«˜è´¨é‡æ¨¡å‹æ—¶ã€‚</li>
                <li>éŸ³é¢‘è´¨é‡è¾ƒå¥½çš„æ–‡ä»¶é€šå¸¸èƒ½è·å¾—æ›´å¥½çš„åˆ†ç¦»æ•ˆæœã€‚</li>
            </ul>
            
            <!-- MCP åè®®ä¿¡æ¯éƒ¨åˆ† -->
            <h2 id="mcp-info">ğŸ”— MCP (Model Context Protocol) æ”¯æŒ</h2>
            <div class="card">
                <h3>âœ¨ æ ‡å‡†MCPåè®®é›†æˆ</h3>
                <p>æœ¬åº”ç”¨ç°åœ¨å®Œå…¨æ”¯æŒ <strong>MCP (Model Context Protocol)</strong> åè®®ï¼è¿™æ„å‘³ç€æ‚¨å¯ä»¥åœ¨ä»»ä½•æ”¯æŒMCPçš„å®¢æˆ·ç«¯ä¸­ä½¿ç”¨æˆ‘ä»¬çš„éŸ³é¢‘åˆ†ç¦»æœåŠ¡ã€‚</p>
                
                <div style="background: #e8f5e8; padding: 15px; border-radius: 8px; margin: 15px 0;">
                    <h4>ğŸ¯ MCPå®¢æˆ·ç«¯é…ç½®</h4>
                    <p><strong>æœåŠ¡å™¨ç«¯ç‚¹:</strong> <code>http://localhost:8080/mcp</code></p>
                    <p><strong>åè®®:</strong> JSON-RPC 2.0 over HTTP</p>
                    <p><strong>æ–¹æ³•:</strong> POST</p>
                    <p><strong>Content-Type:</strong> application/json</p>
                </div>
                
                <h4>ğŸ› ï¸ å¯ç”¨çš„MCPå·¥å…·</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #007aff;">
                        <h5><strong>separate_audio</strong></h5>
                        <p>ä½¿ç”¨Demucsæ¨¡å‹åˆ†ç¦»éŸ³é¢‘æ–‡ä»¶</p>
                        <p><small><strong>å‚æ•°:</strong> file_path, model, stems, stream_progress</small></p>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
                        <h5><strong>get_models</strong></h5>
                        <p>è·å–å¯ç”¨çš„Demucsæ¨¡å‹åˆ—è¡¨</p>
                        <p><small><strong>å‚æ•°:</strong> æ— éœ€å‚æ•°</small></p>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <h5><strong>get_job_status</strong></h5>
                        <p>æŸ¥è¯¢éŸ³é¢‘åˆ†ç¦»ä»»åŠ¡çš„çŠ¶æ€</p>
                        <p><small><strong>å‚æ•°:</strong> job_id</small></p>
                    </div>
                </div>
                
                <h4>ğŸ“š å¯ç”¨çš„MCPèµ„æº</h4>
                <ul>
                    <li><code>demucs://docs/api</code> - å®Œæ•´çš„APIä½¿ç”¨æ–‡æ¡£</li>
                    <li><code>demucs://models/info</code> - è¯¦ç»†çš„æ¨¡å‹ä¿¡æ¯å’Œç‰¹æ€§</li>
                </ul>
                
                <h4>ğŸŒŠ æµå¼è¿›åº¦æ”¯æŒ</h4>
                <p>æˆ‘ä»¬çš„MCPå®ç°æ”¯æŒSSE (Server-Sent Events) æµå¼è¿›åº¦æ›´æ–°ï¼Œæ‚¨å¯ä»¥å®æ—¶ç›‘æ§éŸ³é¢‘åˆ†ç¦»çš„è¿›åº¦ï¼š</p>
                <code>GET http://localhost:8080/mcp/stream/{job_id}</code>
                
                <div style="text-align: center; margin: 20px 0;">
                    <a href="/test/mcp" style="display: inline-block; background: #007aff; color: white; padding: 15px 30px; text-decoration: none; border-radius: 8px; font-size: 16px;">
                        ğŸ§ª æµ‹è¯•MCPåŠŸèƒ½
                    </a>
                </div>
                
                <h4>ğŸ“‹ MCPåè®®ä½¿ç”¨ç¤ºä¾‹</h4>
                
                <p><strong>1. åˆå§‹åŒ–è¿æ¥:</strong></p>
                <pre>{
  "jsonrpc": "2.0",
  "id": 1,
  "method": "initialize",
  "params": {
    "protocolVersion": "1.0",
    "capabilities": {},
    "clientInfo": {
      "name": "your-client-name",
      "version": "1.0.0"
    }
  }
}</pre>
                
                <p><strong>2. è°ƒç”¨éŸ³é¢‘åˆ†ç¦»å·¥å…·:</strong></p>
                <pre>{
  "jsonrpc": "2.0",
  "id": 2,
  "method": "tools/call",
  "params": {
    "name": "separate_audio",
    "arguments": {
      "file_path": "/path/to/audio.mp3",
      "model": "htdemucs",
      "stems": ["vocals", "drums"],
      "stream_progress": true
    }
  }
}</pre>
                
                <p><strong>3. è·å–å¯ç”¨å·¥å…·:</strong></p>
                <pre>{
  "jsonrpc": "2.0",
  "id": 3,
  "method": "tools/list",
  "params": {}
}</pre>
                
                <div class="tip">
                    <strong>ğŸ’¡ é›†æˆæç¤º:</strong> è¿™ä¸ªæ ‡å‡†MCPå®ç°å¯ä»¥ä¸Claude Desktopã€Cursorç­‰æ”¯æŒMCPçš„å·¥å…·æ— ç¼é›†æˆã€‚
                    åªéœ€åœ¨å®¢æˆ·ç«¯é…ç½®ä¸­æ·»åŠ æˆ‘ä»¬çš„æœåŠ¡å™¨ç«¯ç‚¹å³å¯å¼€å§‹ä½¿ç”¨ï¼
                </div>
            </div>
            
            <!-- APIæ–‡æ¡£éƒ¨åˆ† -->
            <h2 id="api-docs">APIæ¥å£æ–‡æ¡£</h2>
            <p>æœ¬åº”ç”¨æä¾›REST APIæ¥å£ï¼Œæ”¯æŒé€šè¿‡ç¼–ç¨‹æ–¹å¼ä½¿ç”¨éŸ³é¢‘åˆ†ç¦»åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯å¯ç”¨çš„APIç«¯ç‚¹åŠå…¶ç”¨æ³•ã€‚</p>
            
            <div class="tip">
                <strong>å¼€å‘è€…æŒ‡å—ï¼š</strong> ä»¥ä¸‹APIæ¥å£å¯ç”¨äºé›†æˆDemucséŸ³é¢‘åˆ†ç¦»åŠŸèƒ½åˆ°æ‚¨è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­ã€‚
                å¤„ç†è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œæäº¤ä»»åŠ¡åæ‚¨ä¼šè·å¾—ä¸€ä¸ªä»»åŠ¡IDï¼Œå¯ä»¥ç”¨å®ƒæ¥è·å–è¿›åº¦æ›´æ–°å’Œæœ€ç»ˆä¸‹è½½åˆ†ç¦»ç»“æœã€‚
                æ‰€æœ‰å“åº”éƒ½é‡‡ç”¨ç»Ÿä¸€çš„JSONæ ¼å¼ï¼ŒåŒ…å«<code>status</code>å’Œ<code>data</code>ä¸¤ä¸ªä¸»è¦å­—æ®µã€‚
            </div>
            
            <div class="card">
                <h3>1. è·å–å¯ç”¨æ¨¡å‹</h3>
                <p><strong>ç«¯ç‚¹:</strong> <code>GET /api/models</code></p>
                <p><strong>æè¿°:</strong> è¿”å›ç³»ç»Ÿä¸­å¯ç”¨çš„æ‰€æœ‰éŸ³é¢‘åˆ†ç¦»æ¨¡å‹åˆ—è¡¨</p>
                <p><strong>ç¤ºä¾‹å“åº”:</strong></p>
                <pre>{
  "status": "success",
  "data": {
    "models": [
      {
        "name": "htdemucs",
        "description": "Hybrid Transformer Demucs",
        "stems": ["vocals", "drums", "bass", "other"]
      },
      {
        "name": "htdemucs_ft",
        "description": "Fine-tuned Hybrid Transformer Demucs",
        "stems": ["vocals", "drums", "bass", "other"]
      },
      ...
    ]
  }
}</pre>
                <p><strong>ä½¿ç”¨ç¤ºä¾‹ (cURL):</strong></p>
                <pre>curl -X GET http://localhost:8080/api/models</pre>
            </div>
            
            <div class="card">
                <h3>2. æäº¤éŸ³é¢‘å¤„ç†ä»»åŠ¡</h3>
                <p><strong>ç«¯ç‚¹:</strong> <code>POST /api/process</code></p>
                <p><strong>æè¿°:</strong> ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶å¹¶å¼€å§‹åˆ†ç¦»å¤„ç†</p>
                <p><strong>è¯·æ±‚å‚æ•°:</strong></p>
                <ul>
                    <li><code>file</code> - è¦å¤„ç†çš„éŸ³é¢‘æ–‡ä»¶ (å¿…éœ€ï¼Œmultipart/form-data)</li>
                    <li><code>model</code> - è¦ä½¿ç”¨çš„æ¨¡å‹åç§° (å¯é€‰ï¼Œé»˜è®¤: htdemucs)</li>
                    <li><code>stems</code> - è¦åˆ†ç¦»çš„éŸ³è½¨ï¼Œé€—å·åˆ†éš” (å¯é€‰ï¼Œé»˜è®¤: å…¨éƒ¨éŸ³è½¨)</li>
                </ul>
                <p><strong>ç¤ºä¾‹å“åº”:</strong></p>
                <pre>{
  "status": "success",
  "data": {
    "job_id": "85f3da9c-7214-4892-b7bd-1e6e498c5d7b",
    "message": "Audio separation started",
    "status_url": "/api/status/85f3da9c-7214-4892-b7bd-1e6e498c5d7b",
    "progress_url": "/api/progress/85f3da9c-7214-4892-b7bd-1e6e498c5d7b",
    "download_url": "/api/download/85f3da9c-7214-4892-b7bd-1e6e498c5d7b"
  }
}</pre>
                <p><strong>ä½¿ç”¨ç¤ºä¾‹ (cURL):</strong></p>
                <pre>curl -X POST \
  http://localhost:8080/api/process \
  -F "file=@song.mp3" \
  -F "model=htdemucs" \
  -F "stems=vocals,drums"</pre>
                <p><strong>ä½¿ç”¨ç¤ºä¾‹ (JavaScript):</strong></p>
                <pre>const formData = new FormData();
formData.append('file', audioFile); // Fileå¯¹è±¡
formData.append('model', 'htdemucs');
formData.append('stems', 'vocals,drums');

// ä½¿ç”¨BASE_URLä½œä¸ºAPIå‰ç¼€
const BASE_URL = window.location.pathname.split('/').filter(p => p)[0] || '';
fetch(`${BASE_URL}/api/process`, {
  method: 'POST',
  body: formData
})
.then(response => response.json())
.then(data => console.log(data));</pre>
            </div>
            
            <div class="card">
                <h3>3. è·å–ä»»åŠ¡çŠ¶æ€</h3>
                <p><strong>ç«¯ç‚¹:</strong> <code>GET /api/status/{job_id}</code></p>
                <p><strong>æè¿°:</strong> è·å–æŒ‡å®šä»»åŠ¡çš„å½“å‰çŠ¶æ€å’Œè¿›åº¦</p>
                <p><strong>ç¤ºä¾‹å“åº”:</strong></p>
                <pre>{
  "status": "success",
  "data": {
    "job_id": "85f3da9c-7214-4892-b7bd-1e6e498c5d7b",
    "progress": 65,
    "message": "æ­£åœ¨å¤„ç†éŸ³é¢‘...",
    "status": "processing"
  }
}</pre>
                <p><strong>ä½¿ç”¨ç¤ºä¾‹ (cURL):</strong></p>
                <pre>curl -X GET http://localhost:8080/api/status/85f3da9c-7214-4892-b7bd-1e6e498c5d7b</pre>
            </div>
            
            <div class="card">
                <h3>4. å®æ—¶è¿›åº¦æ›´æ–°</h3>
                <p><strong>ç«¯ç‚¹:</strong> <code>GET /api/progress/{job_id}</code></p>
                <p><strong>æè¿°:</strong> é€šè¿‡Server-Sent Events (SSE)æ¥æ”¶å®æ—¶è¿›åº¦æ›´æ–°</p>
                <p><strong>è¿”å›:</strong> text/event-stream æ ¼å¼çš„æ•°æ®æµ</p>
                <p><strong>ä½¿ç”¨ç¤ºä¾‹ (JavaScript):</strong></p>
                <pre>// è·å–åŸºç¡€URLè·¯å¾„
const BASE_URL = window.location.pathname.split('/').filter(p => p)[0] || '';
const eventSource = new EventSource(`${BASE_URL}/api/progress/85f3da9c-7214-4892-b7bd-1e6e498c5d7b`);

eventSource.onmessage = (event) => {
  const progress = JSON.parse(event.data);
  console.log(`è¿›åº¦: ${progress.progress}%, æ¶ˆæ¯: ${progress.message}`);
  
  // å½“ä»»åŠ¡å®Œæˆæˆ–å‡ºé”™æ—¶å…³é—­è¿æ¥
  if (progress.status === 'completed' || progress.status === 'error') {
    eventSource.close();
  }
};</pre>
            </div>
            
            <div class="card">
                <h3>5. ä¸‹è½½å¤„ç†ç»“æœ</h3>
                <p><strong>ç«¯ç‚¹:</strong> <code>GET /api/download/{job_id}</code></p>
                <p><strong>æè¿°:</strong> ä¸‹è½½å·²å®Œæˆä»»åŠ¡çš„åˆ†ç¦»éŸ³è½¨ï¼ˆZIPæ ¼å¼ï¼‰</p>
                <p><strong>è¿”å›:</strong> application/zip æ–‡ä»¶</p>
                <p><strong>ä½¿ç”¨ç¤ºä¾‹ (cURL):</strong></p>
                <pre>curl -X GET \
  http://localhost:8080/api/download/85f3da9c-7214-4892-b7bd-1e6e498c5d7b \
  --output separated_tracks.zip</pre>
                <p><strong>ä½¿ç”¨ç¤ºä¾‹ (JavaScript):</strong></p>
                <pre>// ç¤ºä¾‹: ä¸‹è½½å¤„ç†ç»“æœ
const downloadResult = (jobId) => {
  const BASE_URL = window.location.pathname.split('/').filter(p => p)[0] || '';
  window.location.href = `${BASE_URL}/api/download/${jobId}`;
  
  // æˆ–è€…ä½¿ç”¨fetchå¹¶ä¿å­˜æ–‡ä»¶
  fetch(`${BASE_URL}/api/download/${jobId}`)
    .then(response => response.blob())
    .then(blob => {
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'separated_tracks.zip';
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
    });
};</pre>
            </div>
            
            <div class="card">
                <h3>6. æ¸…ç†ä»»åŠ¡æ–‡ä»¶</h3>
                <p><strong>ç«¯ç‚¹:</strong> <code>DELETE /api/cleanup/{job_id}</code></p>
                <p><strong>æè¿°:</strong> æ¸…ç†æŒ‡å®šä»»åŠ¡çš„ç›¸å…³æ–‡ä»¶ï¼Œé‡Šæ”¾æœåŠ¡å™¨å­˜å‚¨ç©ºé—´</p>
                <p><strong>ç¤ºä¾‹å“åº”:</strong></p>
                <pre>{
  "status": "success",
  "data": {
    "message": "ä»»åŠ¡æ–‡ä»¶å·²æˆåŠŸæ¸…ç†"
  }
}</pre>
                <p><strong>ä½¿ç”¨ç¤ºä¾‹ (cURL):</strong></p>
                <pre>curl -X DELETE http://localhost:8080/api/cleanup/85f3da9c-7214-4892-b7bd-1e6e498c5d7b</pre>
            </div>
            
            <div class="tip">
                <strong>æ³¨æ„:</strong> æ‰€æœ‰APIè¯·æ±‚è¿”å›çš„HTTPçŠ¶æ€ç ä¸º200ï¼ˆæˆåŠŸï¼‰æˆ–4xx/5xxï¼ˆé”™è¯¯ï¼‰ã€‚å“åº”ä½“ä¸­çš„statuså­—æ®µä¼šæŒ‡ç¤ºå…·ä½“æ“ä½œæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚ç³»ç»Ÿä¼šåœ¨ä¸€å®šæ—¶é—´åï¼ˆé»˜è®¤1å°æ—¶ï¼‰è‡ªåŠ¨æ¸…ç†æœªè¢«ä¸‹è½½çš„æ–‡ä»¶ã€‚
            </div>
            
            <!-- æ–°å¢æ¥å£è°ƒç”¨å…³ç³»éƒ¨åˆ† -->
            <h2 id="api-flow">APIæ¥å£è°ƒç”¨å…³ç³»</h2>
            <div class="card">
                <h3>å…¸å‹ä½¿ç”¨æµç¨‹</h3>
                <p>ä»¥ä¸‹æ˜¯éŸ³é¢‘åˆ†ç¦»å¤„ç†çš„å®Œæ•´æµç¨‹å’ŒAPIè°ƒç”¨é¡ºåºï¼š</p>
                
                <ol>
                    <li>
                        <strong>è·å–å¯ç”¨æ¨¡å‹åˆ—è¡¨</strong> (å¯é€‰)
                        <p>è°ƒç”¨ <code>GET /api/models</code> è·å–å¯ç”¨çš„æ¨¡å‹åˆ—è¡¨ï¼Œç”¨äºåœ¨ç•Œé¢ä¸Šå±•ç¤ºé€‰é¡¹ã€‚</p>
                    </li>
                    <li>
                        <strong>æäº¤éŸ³é¢‘å¤„ç†ä»»åŠ¡</strong> (å¿…éœ€)
                        <p>è°ƒç”¨ <code>POST /api/process</code> ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶å¹¶è·å–ä»»åŠ¡ID (<code>job_id</code>)ã€‚</p>
                    </li>
                    <li>
                        <strong>ç›‘æ§å¤„ç†è¿›åº¦</strong> (äºŒé€‰ä¸€)
                        <ul>
                            <li>
                                <strong>æ–¹æ³•1: è½®è¯¢</strong>
                                <p>å®šæœŸè°ƒç”¨ <code>GET /api/status/{job_id}</code> è·å–æœ€æ–°è¿›åº¦ã€‚</p>
                                <pre>// ç¤ºä¾‹: è½®è¯¢æ–¹å¼è·å–è¿›åº¦
const checkStatus = (jobId) => {
  const BASE_URL = window.location.pathname.split('/').filter(p => p)[0] || '';
  const intervalId = setInterval(async () => {
    const response = await fetch(`${BASE_URL}/api/status/${jobId}`);
    const data = await response.json();
    
    if (data.status === 'success') {
      const progress = data.data;
      
      // æ›´æ–°UIæ˜¾ç¤ºè¿›åº¦
      updateProgressUI(progress.progress, progress.message);
      
      // å¦‚æœä»»åŠ¡å®Œæˆæˆ–å‡ºé”™ï¼Œåœæ­¢è½®è¯¢
      if (progress.status === 'completed' || progress.status === 'error') {
        clearInterval(intervalId);
        handleTaskCompletion(progress, jobId);
      }
    }
  }, 2000);
};</pre>
                            </li>
                            <li>
                                <strong>æ–¹æ³•2: SSEå®æ—¶æ›´æ–°</strong> (æ¨è)
                                <p>å»ºç«‹ <code>GET /api/progress/{job_id}</code> SSEè¿æ¥ï¼Œæ¥æ”¶å®æ—¶è¿›åº¦æ›´æ–°ã€‚</p>
                                <pre>// ç¤ºä¾‹: å»ºç«‹SSEè¿æ¥è·å–å®æ—¶è¿›åº¦
const connectToSSE = (jobId) => {
  const BASE_URL = window.location.pathname.split('/').filter(p => p)[0] || '';
  const eventSource = new EventSource(`${BASE_URL}/api/progress/${jobId}`);
  
  eventSource.onmessage = (event) => {
    const progress = JSON.parse(event.data);
    
    // æ›´æ–°UIæ˜¾ç¤ºè¿›åº¦
    updateProgressUI(progress.progress, progress.message);
    
    // å¦‚æœä»»åŠ¡å®Œæˆæˆ–å‡ºé”™ï¼Œå…³é—­SSEè¿æ¥
    if (progress.status === 'completed' || progress.status === 'error') {
      eventSource.close();
      handleTaskCompletion(progress, jobId);
    }
  };
  
  eventSource.onerror = () => {
    // å¤„ç†è¿æ¥é”™è¯¯
    console.error('SSEè¿æ¥é”™è¯¯');
    eventSource.close();
    
    // å¯ä»¥å°è¯•å›é€€åˆ°è½®è¯¢æ–¹å¼
    checkStatus(jobId);
  };
};</pre>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <strong>ä¸‹è½½å¤„ç†ç»“æœ</strong> (ä»»åŠ¡å®Œæˆå)
                        <p>ä»»åŠ¡å®Œæˆåè°ƒç”¨ <code>GET /api/download/{job_id}</code> ä¸‹è½½åˆ†ç¦»çš„éŸ³è½¨ã€‚</p>
                        <pre>// ç¤ºä¾‹: ä¸‹è½½å¤„ç†ç»“æœ
const downloadResult = (jobId) => {
  const BASE_URL = window.location.pathname.split('/').filter(p => p)[0] || '';
  window.location.href = `${BASE_URL}/api/download/${jobId}`;
  
  // æˆ–è€…ä½¿ç”¨fetchå¹¶ä¿å­˜æ–‡ä»¶
  fetch(`${BASE_URL}/api/download/${jobId}`)
    .then(response => response.blob())
    .then(blob => {
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'separated_tracks.zip';
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
    });
};</pre>
                    </li>
                    <li>
                        <strong>æ¸…ç†èµ„æº</strong> (å¯é€‰)
                        <p>ä¸‹è½½å®Œæˆåè°ƒç”¨ <code>DELETE /api/cleanup/{job_id}</code> æ¸…ç†æœåŠ¡å™¨ä¸Šçš„ä¸´æ—¶æ–‡ä»¶ã€‚</p>
                        <pre>// ç¤ºä¾‹: æ¸…ç†ä»»åŠ¡èµ„æº
const cleanupResources = async (jobId) => {
  const BASE_URL = window.location.pathname.split('/').filter(p => p)[0] || '';
  try {
    const response = await fetch(`${BASE_URL}/api/cleanup/${jobId}`, {
      method: 'DELETE'
    });
    const data = await response.json();
    console.log('èµ„æºæ¸…ç†ç»“æœ:', data);
  } catch (error) {
    console.error('æ¸…ç†èµ„æºå‡ºé”™:', error);
  }
};</pre>
                    </li>
                </ol>
                
                <h3>é”™è¯¯å¤„ç†ç­–ç•¥</h3>
                <p>åœ¨è°ƒç”¨APIæ—¶ï¼Œåº”å½“å®ç°ä»¥ä¸‹é”™è¯¯å¤„ç†ç­–ç•¥ï¼š</p>
                <ul>
                    <li><strong>ç½‘ç»œé”™è¯¯</strong>: æ£€æµ‹ç½‘ç»œè¿æ¥é—®é¢˜ï¼Œå¿…è¦æ—¶é‡è¯•è¯·æ±‚</li>
                    <li><strong>æœåŠ¡å™¨é”™è¯¯</strong>: é€‚å½“å±•ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œæä¾›é‡è¯•é€‰é¡¹</li>
                    <li><strong>SSEè¿æ¥ä¸­æ–­</strong>: å¦‚æœSSEè¿æ¥å¤±è´¥ï¼Œå›é€€åˆ°è½®è¯¢æ–¹å¼è·å–è¿›åº¦</li>
                    <li><strong>ä»»åŠ¡å¤„ç†é”™è¯¯</strong>: æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯ï¼ŒæŒ‡å¯¼ç”¨æˆ·å¯èƒ½çš„è§£å†³æ–¹æ¡ˆ</li>
                </ul>
                
                <h3>æ¥å£ä¾èµ–å…³ç³»</h3>
                <p>å„APIæ¥å£ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼š</p>
                <ul>
                    <li><code>/api/status/{job_id}</code> å’Œ <code>/api/progress/{job_id}</code> ä¾èµ–äºå…ˆè°ƒç”¨ <code>/api/process</code> è·å–çš„job_id</li>
                    <li><code>/api/download/{job_id}</code> ä¾èµ–äºä»»åŠ¡å¤„ç†å®Œæˆï¼ˆçŠ¶æ€ä¸º"completed"ï¼‰</li>
                    <li><code>/api/cleanup/{job_id}</code> åº”åœ¨ä¸‹è½½å®Œæˆåè°ƒç”¨ï¼Œä»¥é‡Šæ”¾æœåŠ¡å™¨èµ„æº</li>
                </ul>
            </div>
            
            <!-- æ–°å¢æµ‹è¯•ç”¨ä¾‹éƒ¨åˆ† -->
            <h2 id="api-testing">APIæµ‹è¯•æŒ‡å—</h2>
            <div class="card">
                <h3>å¦‚ä½•æµ‹è¯•APIæ¥å£</h3>
                <p>æˆ‘ä»¬æä¾›äº†å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼Œç”¨äºéªŒè¯APIæ¥å£çš„åŠŸèƒ½æ­£ç¡®æ€§ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œæµ‹è¯•ï¼š</p>
                
                <h4>æ–¹æ³•ä¸€: ä½¿ç”¨å†…ç½®æµ‹è¯•å·¥å…·</h4>
                <p>æˆ‘ä»¬æä¾›äº†è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼Œå¯ä»¥ä¸€é”®æµ‹è¯•æ‰€æœ‰APIæ¥å£ï¼š</p>
                <pre>cd test
python run_tests.py --test api</pre>
                
                <p>æµ‹è¯•ç»“æœå°†æ˜¾ç¤ºæ¯ä¸ªAPIæ¥å£çš„æµ‹è¯•çŠ¶æ€ã€‚æ‚¨ä¹Ÿå¯ä»¥æµ‹è¯•ç‰¹å®šåŠŸèƒ½ï¼š</p>
                <pre># æµ‹è¯•FFmpegå…¼å®¹æ€§
python run_tests.py --test ffmpeg

# æµ‹è¯•è¿›åº¦åé¦ˆæœºåˆ¶
python run_tests.py --test progress

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python run_tests.py</pre>
                
                <h4>æ–¹æ³•äºŒ: ä½¿ç”¨å‘½ä»¤è¡Œå·¥å…·</h4>
                <p>æ‚¨å¯ä»¥ä½¿ç”¨curlæˆ–ç±»ä¼¼å·¥å…·æ‰‹åŠ¨æµ‹è¯•å„ä¸ªæ¥å£ï¼š</p>
                
                <p><strong>1. è·å–æ¨¡å‹åˆ—è¡¨</strong></p>
                <pre>curl http://localhost:5001/api/models</pre>
                
                <p><strong>2. ä¸Šä¼ æ–‡ä»¶å¹¶å¤„ç†</strong></p>
                <pre>curl -X POST \
  http://localhost:5001/api/process \
  -F "file=@/path/to/audio.mp3" \
  -F "model=htdemucs" \
  -F "stems=vocals,drums"</pre>
                
                <p><strong>3. æŸ¥è¯¢çŠ¶æ€</strong> (ä½¿ç”¨ä¸Šä¸€æ­¥è¿”å›çš„job_id)</p>
                <pre>curl http://localhost:5001/api/status/{job_id}</pre>
                
                <p><strong>4. ä¸‹è½½ç»“æœ</strong></p>
                <pre>curl http://localhost:5001/api/download/{job_id} --output separated_tracks.zip</pre>
                
                <p><strong>5. æ¸…ç†èµ„æº</strong></p>
                <pre>curl -X DELETE http://localhost:5001/api/cleanup/{job_id}</pre>
                
                <h4>æ–¹æ³•ä¸‰: ä½¿ç”¨Postmanç­‰å·¥å…·</h4>
                <p>æ‚¨å¯ä»¥ä½¿ç”¨Postmanã€Insomniaç­‰APIæµ‹è¯•å·¥å…·è¿›è¡Œæ›´ç›´è§‚çš„æµ‹è¯•ï¼š</p>
                <ol>
                    <li>åˆ›å»ºä¸€ä¸ªæ–°çš„è¯·æ±‚é›†åˆ</li>
                    <li>ä¾æ¬¡æ·»åŠ ä¸Šè¿°5ä¸ªAPIçš„è¯·æ±‚</li>
                    <li>å¯¹äºæ–‡ä»¶ä¸Šä¼ è¯·æ±‚ï¼Œä½¿ç”¨form-dataæ ¼å¼å¹¶æ·»åŠ æ–‡ä»¶</li>
                    <li>ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨job_idï¼Œæ–¹ä¾¿åç»­è¯·æ±‚ä½¿ç”¨</li>
                </ol>
                
                <h3>æµ‹è¯•ç”¨ä¾‹è®¾è®¡</h3>
                <p>å®Œæ•´çš„æµ‹è¯•åº”è¦†ç›–ä»¥ä¸‹åœºæ™¯ï¼š</p>
                <ul>
                    <li><strong>æ­£å¸¸æµç¨‹æµ‹è¯•</strong>: éªŒè¯å®Œæ•´å¤„ç†æµç¨‹</li>
                    <li><strong>å‚æ•°éªŒè¯æµ‹è¯•</strong>: æµ‹è¯•æ— æ•ˆå‚æ•°çš„å¤„ç†</li>
                    <li><strong>é”™è¯¯å¤„ç†æµ‹è¯•</strong>: æµ‹è¯•ç³»ç»Ÿå¯¹å„ç§é”™è¯¯æƒ…å†µçš„å“åº”</li>
                    <li><strong>æ€§èƒ½æµ‹è¯•</strong>: æµ‹è¯•ç³»ç»Ÿåœ¨å¤„ç†å¤§æ–‡ä»¶æ—¶çš„è¡¨ç°</li>
                    <li><strong>å¹¶å‘æµ‹è¯•</strong>: æµ‹è¯•ç³»ç»ŸåŒæ—¶å¤„ç†å¤šä¸ªè¯·æ±‚çš„èƒ½åŠ›</li>
                </ul>
                
                <h3>å…¸å‹æµ‹è¯•ç”¨ä¾‹</h3>
                <table border="1" style="width:100%; border-collapse: collapse; margin-top: 10px;">
                    <tr>
                        <th>æµ‹è¯•ID</th>
                        <th>æµ‹è¯•åœºæ™¯</th>
                        <th>æµ‹è¯•æ­¥éª¤</th>
                        <th>é¢„æœŸç»“æœ</th>
                    </tr>
                    <tr>
                        <td>API-001</td>
                        <td>åŸºæœ¬éŸ³é¢‘å¤„ç†æµç¨‹</td>
                        <td>
                            1. è·å–æ¨¡å‹åˆ—è¡¨<br>
                            2. ä¸Šä¼ MP3æ–‡ä»¶è¿›è¡Œå¤„ç†<br>
                            3. ç›‘æ§è¿›åº¦ç›´åˆ°å®Œæˆ<br>
                            4. ä¸‹è½½ç»“æœæ–‡ä»¶<br>
                            5. æ¸…ç†èµ„æº
                        </td>
                        <td>
                            1. æˆåŠŸè·å–æ¨¡å‹åˆ—è¡¨<br>
                            2. æˆåŠŸåˆ›å»ºå¤„ç†ä»»åŠ¡<br>
                            3. è¿›åº¦ä»0%å¢åŠ åˆ°100%<br>
                            4. æˆåŠŸä¸‹è½½ZIPæ–‡ä»¶<br>
                            5. èµ„æºæ¸…ç†æˆåŠŸ
                        </td>
                    </tr>
                    <tr>
                        <td>API-002</td>
                        <td>æ–‡ä»¶æ ¼å¼éªŒè¯</td>
                        <td>
                            1. å°è¯•ä¸Šä¼ ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼ï¼ˆå¦‚.txtï¼‰
                        </td>
                        <td>
                            1. è¿”å›400é”™è¯¯<br>
                            2. å“åº”åŒ…å«æ˜ç¡®çš„é”™è¯¯ä¿¡æ¯
                        </td>
                    </tr>
                    <tr>
                        <td>API-003</td>
                        <td>æ— æ•ˆä»»åŠ¡IDå¤„ç†</td>
                        <td>
                            1. ä½¿ç”¨ä¸å­˜åœ¨çš„job_idè¯·æ±‚çŠ¶æ€<br>
                            2. ä½¿ç”¨ä¸å­˜åœ¨çš„job_idè¯·æ±‚ä¸‹è½½
                        </td>
                        <td>
                            1. è¿”å›404é”™è¯¯<br>
                            2. å“åº”åŒ…å«"ä»»åŠ¡ä¸å­˜åœ¨"ä¿¡æ¯
                        </td>
                    </tr>
                    <tr>
                        <td>API-004</td>
                        <td>SSEè¿æ¥ç¨³å®šæ€§</td>
                        <td>
                            1. å»ºç«‹SSEè¿æ¥<br>
                            2. æ¨¡æ‹Ÿç½‘ç»œæ³¢åŠ¨<br>
                            3. æ¢å¤è¿æ¥
                        </td>
                        <td>
                            1. SSEè¿æ¥æ¢å¤åç»§ç»­æ¥æ”¶è¿›åº¦æ›´æ–°<br>
                            2. ä¸ä¸¢å¤±é‡è¦çŠ¶æ€å˜åŒ–
                        </td>
                    </tr>
                    <tr>
                        <td>API-005</td>
                        <td>å¹¶å‘å¤„ç†æµ‹è¯•</td>
                        <td>
                            1. åŒæ—¶æäº¤å¤šä¸ªå¤„ç†ä»»åŠ¡<br>
                            2. ç›‘æ§æ‰€æœ‰ä»»åŠ¡çš„è¿›åº¦
                        </td>
                        <td>
                            1. æ‰€æœ‰ä»»åŠ¡éƒ½è¢«æ­£ç¡®å¤„ç†<br>
                            2. ä»»åŠ¡ä¹‹é—´ä¸ç›¸äº’å¹²æ‰°
                        </td>
                    </tr>
                </table>
                
                <h3>æµ‹è¯•æ–‡ä»¶</h3>
                <p>ä¸ºæ–¹ä¾¿æµ‹è¯•ï¼Œæˆ‘ä»¬æä¾›äº†ä»¥ä¸‹æµ‹è¯•éŸ³é¢‘æ–‡ä»¶ï¼š</p>
                <ul>
                    <li><code>test.mp3</code> - æ ‡å‡†æµ‹è¯•æ–‡ä»¶ (5ç§’)</li>
                    <li><code>test_long.mp3</code> - é•¿éŸ³é¢‘æµ‹è¯•æ–‡ä»¶ (30ç§’)</li>
                    <li><code>test_stereo.mp3</code> - ç«‹ä½“å£°æµ‹è¯•æ–‡ä»¶</li>
                    <li><code>test_mono.mp3</code> - å•å£°é“æµ‹è¯•æ–‡ä»¶</li>
                </ul>
                <p>æ‚¨å¯ä»¥åœ¨<code>test</code>ç›®å½•ä¸‹æ‰¾åˆ°è¿™äº›æ–‡ä»¶ã€‚</p>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>DemucséŸ³é¢‘åˆ†ç¦»å·¥å…· &copy; 2023 | åŸºäº<a href="https://github.com/facebookresearch/demucs" style="color: white; text-decoration: underline;">Demucs</a>å¼€å‘</p>
        </div>
    </footer>

    <!-- æ·»åŠ MCP SSEå®¢æˆ·ç«¯è„šæœ¬ -->
    <script src="{{ base_url }}/static/js/mcp_sse_client.js"></script>
    
    <script>
        // è®¾ç½®APIåŸºç¡€è·¯å¾„ï¼Œä»æœåŠ¡å™¨ç«¯ä¼ é€’
        const BASE_URL = "{{ base_url }}";
        
        // DOM elements
        const form = document.getElementById('separationForm');
        const dropArea = document.getElementById('dropArea');
        const fileInput = document.getElementById('audioFile');
        const submitBtn = document.getElementById('submitBtn');
        const progressContainer = document.getElementById('progressContainer');
        const progressFill = document.getElementById('progressFill');
        const progressText = document.getElementById('progressText');
        const statusMessage = document.getElementById('statusMessage');
        const downloadLink = document.getElementById('downloadLink');
        
        // åˆ›å»ºMCP SSEå®¢æˆ·ç«¯å®ä¾‹
        const mcpClient = new MCPSSEClient(BASE_URL, {
            debug: false,
            autoReconnect: true
        });
        
        // ç›‘å¬è¿›åº¦äº‹ä»¶
        mcpClient.on('progress', (data) => {
            console.log('MCPè¿›åº¦æ›´æ–°:', data);
            
            // åŸºæœ¬æ•°æ®éªŒè¯
            const progressValue = typeof data.progress === 'number' ? 
                data.progress : parseInt(data.progress, 10) || 0;
            
            // æ›´æ–°è¿›åº¦æ¡
            progressFill.style.width = `${progressValue}%`;
            
            // æ„å»ºæ˜¾ç¤ºæ–‡æœ¬
            const displayText = data.message ? 
                `${progressValue}% - ${data.message}` : 
                `${progressValue}%`;
                
            progressText.textContent = displayText;
            
            // å¤„ç†ä»»åŠ¡çŠ¶æ€
            if (data.status === 'completed' || data.status === 'éŸ³é¢‘åˆ†ç¦»å®Œæˆ') {
                statusMessage.textContent = 'å¤„ç†å®Œæˆï¼';
                statusMessage.className = 'status-message status-success';
                submitBtn.disabled = false;
            } else if (data.status === 'error') {
                statusMessage.textContent = data.message || 'å¤„ç†å‡ºé”™';
                statusMessage.className = 'status-message status-error';
                submitBtn.disabled = false;
            }
        });
        
        // ç›‘å¬è¿æ¥å’Œé”™è¯¯äº‹ä»¶
        mcpClient.on('error', (error) => {
            console.error('MCP SSEè¿æ¥é”™è¯¯:', error);
            statusMessage.textContent = 'ä¸æœåŠ¡å™¨çš„è¿æ¥å‡ºç°é—®é¢˜ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•';
            statusMessage.className = 'status-message status-error';
        });
        
        // Handle file selection
        fileInput.addEventListener('change', () => {
            if (fileInput.files.length > 0) {
                dropArea.textContent = `å·²é€‰æ‹©æ–‡ä»¶: ${fileInput.files[0].name}`;
                submitBtn.disabled = false;
            } else {
                dropArea.innerHTML = '<p>å°†éŸ³é¢‘æ–‡ä»¶æ‹–æ”¾åˆ°æ­¤å¤„ï¼Œæˆ–ç‚¹å‡»é€‰æ‹©æ–‡ä»¶</p>';
                submitBtn.disabled = true;
            }
        });
        
        // Handle drag and drop
        dropArea.addEventListener('click', () => fileInput.click());
        
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.style.background = 'rgba(52, 152, 219, 0.2)';
        });
        
        dropArea.addEventListener('dragleave', () => {
            dropArea.style.background = 'rgba(52, 152, 219, 0.05)';
        });
        
        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.style.background = 'rgba(52, 152, 219, 0.05)';
            
            if (e.dataTransfer.files.length > 0) {
                fileInput.files = e.dataTransfer.files;
                dropArea.textContent = `å·²é€‰æ‹©æ–‡ä»¶: ${fileInput.files[0].name}`;
                submitBtn.disabled = false;
            }
        });
        
        // Handle form submission
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Validate file
            if (!fileInput.files[0]) {
                alert('è¯·é€‰æ‹©éŸ³é¢‘æ–‡ä»¶');
                return;
            }
            
            // Prepare form data
            const formData = new FormData();
            formData.append('file', fileInput.files[0]);
            formData.append('model', document.getElementById('modelSelect').value);
            
            // Handle stems selection
            const stemsSelect = document.getElementById('stemsSelect');
            const selectedStems = Array.from(stemsSelect.selectedOptions).map(option => option.value);
            if (selectedStems.length > 0) {
                formData.append('stems', selectedStems.join(','));
            }
            
            // Show progress container
            progressContainer.style.display = 'block';
            submitBtn.disabled = true;
            
            try {
                // Submit the processing request
                const response = await fetch(`${BASE_URL}/api/process`, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`æœåŠ¡å™¨é”™è¯¯: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    // Get the job ID
                    const jobId = data.data.job_id;
                    const downloadUrl = `${BASE_URL}${data.data.download_url}`;
                    
                    // ä½¿ç”¨MCP SSEå®¢æˆ·ç«¯è¿æ¥
                    try {
                        await mcpClient.connect(jobId);
                        console.log('å·²è¿æ¥åˆ°MCP SSE');
                    } catch (error) {
                        console.error('MCP SSEè¿æ¥å¤±è´¥ï¼Œå›é€€åˆ°ä¼ ç»ŸSSE:', error);
                        // å›é€€åˆ°ä¼ ç»ŸSSE
                        setupTraditionalSSE(jobId, downloadUrl);
                    }
                    
                    // è®¾ç½®ä¸‹è½½é“¾æ¥
                    downloadLink.href = downloadUrl;
                    downloadLink.addEventListener('click', () => {
                        // åœ¨ä¸‹è½½å®Œæˆåè‡ªåŠ¨æ¸…ç†èµ„æº
                        setTimeout(async () => {
                            try {
                                await mcpClient.cleanup(jobId);
                                console.log('èµ„æºå·²æ¸…ç†');
                            } catch (error) {
                                console.error('æ¸…ç†èµ„æºå‡ºé”™:', error);
                            }
                        }, 3000);
                    });
                    
                } else {
                    throw new Error(data.message || 'æœªçŸ¥é”™è¯¯');
                }
                
            } catch (error) {
                console.error('é”™è¯¯:', error);
                statusMessage.textContent = `é”™è¯¯: ${error.message}`;
                statusMessage.className = 'status-message status-error';
                submitBtn.disabled = false;
            }
        });
        
        // ä¼ ç»ŸSSEå›é€€å‡½æ•°
        function setupTraditionalSSE(jobId, downloadUrl) {
            const progressUrl = `${BASE_URL}/api/progress/${jobId}`;
            const eventSource = new EventSource(progressUrl);
            
            eventSource.onopen = (event) => {
                console.log('ä¼ ç»ŸSSEè¿æ¥å·²å»ºç«‹');
            };
            
            eventSource.onmessage = (event) => {
                try {
                    console.log('ä¼ ç»ŸSSEåŸå§‹æ•°æ®:', event.data);
                    const progress = JSON.parse(event.data);
                    
                    // åŸºæœ¬æ•°æ®éªŒè¯
                    const progressValue = typeof progress.progress === 'number' ? 
                        progress.progress : parseInt(progress.progress, 10) || 0;
                    
                    // æ›´æ–°è¿›åº¦æ¡
                    progressFill.style.width = `${progressValue}%`;
                    
                    // æ„å»ºæ˜¾ç¤ºæ–‡æœ¬
                    const displayText = progress.message ? 
                        `${progressValue}% - ${progress.message}` : 
                        `${progressValue}%`;
                        
                    progressText.textContent = displayText;
                    
                    // Handle completion
                    if (progress.status === 'completed' || progress.status === 'éŸ³é¢‘åˆ†ç¦»å®Œæˆ') {
                        eventSource.close();
                        statusMessage.textContent = 'å¤„ç†å®Œæˆï¼';
                        statusMessage.className = 'status-message status-success';
                        
                        // Show download link
                        downloadLink.href = downloadUrl;
                        downloadLink.style.display = 'inline-block';
                        
                        // Reset form
                        submitBtn.disabled = false;
                    }
                    
                    // Handle error
                    if (progress.status === 'error') {
                        eventSource.close();
                        statusMessage.textContent = progress.message || 'å¤„ç†å‡ºé”™';
                        statusMessage.className = 'status-message status-error';
                        submitBtn.disabled = false;
                    }
                } catch (error) {
                    console.error('è§£æSSEæ¶ˆæ¯å‡ºé”™:', error);
                    statusMessage.textContent = `è§£æè¿›åº¦æ›´æ–°å‡ºé”™: ${error.message}`;
                    statusMessage.className = 'status-message status-error';
                }
            };
            
            eventSource.onerror = (error) => {
                console.error('SSEè¿æ¥é”™è¯¯:', error);
                eventSource.close();
                statusMessage.textContent = 'æ¥æ”¶è¿›åº¦æ›´æ–°æ—¶å‡ºé”™';
                statusMessage.className = 'status-message status-error';
                submitBtn.disabled = false;
            };
        }
    </script>
</body>
</html> 