<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APIæ–‡æ¡£ - Demucs éŸ³é¢‘åˆ†ç¦»å·¥å…·</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
</head>
<body>
    <header>
        <div class="container">
            <h1>ğŸ“š APIæ¥å£æ–‡æ¡£</h1>
            <p>å®Œæ•´çš„REST APIä½¿ç”¨æŒ‡å—ï¼Œæ”¯æŒç¼–ç¨‹æ–¹å¼é›†æˆéŸ³é¢‘åˆ†ç¦»åŠŸèƒ½</p>
            <div class="main-nav">
                <a href="/" class="nav-link">ğŸ  é¦–é¡µ</a>
                <a href="/mcp" class="nav-link">ğŸ”— MCPåè®®</a>
                <a href="/api-docs" class="nav-link active">ğŸ“š APIæ–‡æ¡£</a>
                <a href="/docs" class="nav-link">ğŸ“– ä½¿ç”¨æŒ‡å—</a>
                <a href="/test-guide" class="nav-link">ğŸ§ª æµ‹è¯•æŒ‡å—</a>
                <a href="/admin" class="nav-link">ğŸ› ï¸ ç®¡ç†é¢æ¿</a>
            </div>
        </div>
    </header>
    
    <div class="container container-sm">
        <!-- APIç›®å½• -->
        <div class="card" style="background: #f8f9fa;">
            <h3>ğŸ“‹ APIæ¥å£ç›®å½•</h3>
            <ul style="list-style: none; padding-left: 0;">
                <li style="margin: 8px 0;"><a href="#api-overview" style="color: var(--primary-color); text-decoration: none;">ğŸ“– æ¥å£æ¦‚è¿°</a></li>
                <li style="margin: 8px 0;"><a href="#api-models" style="color: var(--primary-color); text-decoration: none;">1. è·å–å¯ç”¨æ¨¡å‹</a></li>
                <li style="margin: 8px 0;"><a href="#api-formats" style="color: var(--primary-color); text-decoration: none;">2. è·å–æ”¯æŒçš„è¾“å‡ºæ ¼å¼ <span class="badge" style="background: #28a745; color: white;">æ–°åŠŸèƒ½</span></a></li>
                <li style="margin: 8px 0;"><a href="#api-qualities" style="color: var(--primary-color); text-decoration: none;">3. è·å–éŸ³é¢‘è´¨é‡é€‰é¡¹ <span class="badge" style="background: #28a745; color: white;">æ–°åŠŸèƒ½</span></a></li>
                <li style="margin: 8px 0;"><a href="#api-process" style="color: var(--primary-color); text-decoration: none;">4. æäº¤éŸ³é¢‘å¤„ç†ä»»åŠ¡ <span class="badge" style="background: #ffc107; color: #000;">å·²å‡çº§</span></a></li>
                <li style="margin: 8px 0;"><a href="#api-status" style="color: var(--primary-color); text-decoration: none;">5. è·å–ä»»åŠ¡çŠ¶æ€</a></li>
                <li style="margin: 8px 0;"><a href="#api-progress" style="color: var(--primary-color); text-decoration: none;">6. å®æ—¶è¿›åº¦æ›´æ–°</a></li>
                <li style="margin: 8px 0;"><a href="#api-download" style="color: var(--primary-color); text-decoration: none;">7. ä¸‹è½½å¤„ç†ç»“æœ</a></li>
                <li style="margin: 8px 0;"><a href="#api-cleanup" style="color: var(--primary-color); text-decoration: none;">8. æ¸…ç†ä»»åŠ¡æ–‡ä»¶</a></li>
                <li style="margin: 8px 0;"><a href="#api-flow" style="color: var(--primary-color); text-decoration: none;">ğŸ”„ æ¥å£è°ƒç”¨æµç¨‹</a></li>
            </ul>
        </div>

        <!-- æ¥å£æ¦‚è¿° -->
        <div class="card" id="api-overview">
            <h2>ğŸ“– æ¥å£æ¦‚è¿°</h2>
            <p>æœ¬åº”ç”¨æä¾›REST APIæ¥å£ï¼Œæ”¯æŒé€šè¿‡ç¼–ç¨‹æ–¹å¼ä½¿ç”¨éŸ³é¢‘åˆ†ç¦»åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯å¯ç”¨çš„APIç«¯ç‚¹åŠå…¶ç”¨æ³•ã€‚</p>
            
            <div class="tip">
                <strong>å¼€å‘è€…æŒ‡å—ï¼š</strong> ä»¥ä¸‹APIæ¥å£å¯ç”¨äºé›†æˆDemucséŸ³é¢‘åˆ†ç¦»åŠŸèƒ½åˆ°æ‚¨è‡ªå·±çš„åº”ç”¨ç¨‹åºä¸­ã€‚
                å¤„ç†è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œæäº¤ä»»åŠ¡åæ‚¨ä¼šè·å¾—ä¸€ä¸ªä»»åŠ¡IDï¼Œå¯ä»¥ç”¨å®ƒæ¥è·å–è¿›åº¦æ›´æ–°å’Œæœ€ç»ˆä¸‹è½½åˆ†ç¦»ç»“æœã€‚
                æ‰€æœ‰å“åº”éƒ½é‡‡ç”¨ç»Ÿä¸€çš„JSONæ ¼å¼ï¼ŒåŒ…å«<code>status</code>å’Œ<code>data</code>ä¸¤ä¸ªä¸»è¦å­—æ®µã€‚
            </div>
        </div>

        <!-- 1. è·å–å¯ç”¨æ¨¡å‹ -->
        <div class="card" id="api-models">
            <h3>1. è·å–å¯ç”¨æ¨¡å‹</h3>
            <p><strong>ç«¯ç‚¹:</strong> <code>GET /api/models</code></p>
            <p><strong>æè¿°:</strong> è¿”å›ç³»ç»Ÿä¸­å¯ç”¨çš„æ‰€æœ‰éŸ³é¢‘åˆ†ç¦»æ¨¡å‹åˆ—è¡¨</p>
            <p><strong>ç¤ºä¾‹å“åº”:</strong></p>
            <pre>{
  "status": "success",
  "data": {
    "models": ["htdemucs", "htdemucs_ft", "htdemucs_6s", "mdx", "mdx_q"],
    "default": "htdemucs"
  }
}</pre>
            <p><strong>ä½¿ç”¨ç¤ºä¾‹ (cURL):</strong></p>
            <pre>curl -X GET http://localhost:8080/api/models</pre>
        </div>

        <!-- 2. è·å–æ”¯æŒçš„è¾“å‡ºæ ¼å¼ -->
        <div class="card" id="api-formats">
            <h3>2. è·å–æ”¯æŒçš„è¾“å‡ºæ ¼å¼ <span class="badge new">æ–°åŠŸèƒ½</span></h3>
            <p><strong>ç«¯ç‚¹:</strong> <code>GET /api/formats</code></p>
            <p><strong>æè¿°:</strong> è¿”å›æ”¯æŒçš„éŸ³é¢‘è¾“å‡ºæ ¼å¼åˆ—è¡¨</p>
            <p><strong>ç¤ºä¾‹å“åº”:</strong></p>
            <pre>{
  "status": "success",
  "data": {
    "formats": ["wav", "mp3", "flac"],
    "default": "wav"
  }
}</pre>
            <p><strong>ä½¿ç”¨ç¤ºä¾‹ (cURL):</strong></p>
            <pre>curl -X GET http://localhost:8080/api/formats</pre>
        </div>

        <!-- 3. è·å–éŸ³é¢‘è´¨é‡é€‰é¡¹ -->
        <div class="card" id="api-qualities">
            <h3>3. è·å–éŸ³é¢‘è´¨é‡é€‰é¡¹ <span class="badge new">æ–°åŠŸèƒ½</span></h3>
            <p><strong>ç«¯ç‚¹:</strong> <code>GET /api/qualities</code></p>
            <p><strong>æè¿°:</strong> è¿”å›å¯ç”¨çš„éŸ³é¢‘è´¨é‡é€‰é¡¹åŠå…¶æè¿°</p>
            <p><strong>ç¤ºä¾‹å“åº”:</strong></p>
            <pre>{
  "status": "success",
  "data": {
    "qualities": {
      "low": "ä½è´¨é‡ (128kbps, 22kHz)",
      "medium": "ä¸­ç­‰è´¨é‡ (192kbps, 44kHz)", 
      "high": "é«˜è´¨é‡ (320kbps, 44kHz)",
      "lossless": "æ— æŸè´¨é‡ (WAV/FLAC, 44kHz)"
    },
    "default": "high"
  }
}</pre>
            <p><strong>ä½¿ç”¨ç¤ºä¾‹ (cURL):</strong></p>
            <pre>curl -X GET http://localhost:8080/api/qualities</pre>
        </div>

        <!-- 4. æäº¤éŸ³é¢‘å¤„ç†ä»»åŠ¡ -->
        <div class="card" id="api-process">
            <h3>4. æäº¤éŸ³é¢‘å¤„ç†ä»»åŠ¡ <span class="badge updated">å·²å‡çº§</span></h3>
            <p><strong>ç«¯ç‚¹:</strong> <code>POST /api/process</code></p>
            <p><strong>æè¿°:</strong> ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶å¹¶å¼€å§‹åˆ†ç¦»å¤„ç†ï¼Œæ”¯æŒè‡ªå®šä¹‰è¾“å‡ºæ ¼å¼å’Œè´¨é‡</p>
            <p><strong>è¯·æ±‚å‚æ•°:</strong></p>
            <ul>
                <li><code>file</code> - è¦å¤„ç†çš„éŸ³é¢‘æ–‡ä»¶ (å¿…éœ€ï¼Œmultipart/form-data)</li>
                <li><code>model</code> - è¦ä½¿ç”¨çš„æ¨¡å‹åç§° (å¯é€‰ï¼Œé»˜è®¤: htdemucs)</li>
                <li><code>stems</code> - è¦åˆ†ç¦»çš„éŸ³è½¨ï¼Œé€—å·åˆ†éš” (å¯é€‰ï¼Œé»˜è®¤: å…¨éƒ¨éŸ³è½¨)</li>
                <li><code>output_format</code> - è¾“å‡ºéŸ³é¢‘æ ¼å¼ (å¯é€‰ï¼Œé»˜è®¤: wav) <span class="badge new">æ–°å‚æ•°</span></li>
                <li><code>audio_quality</code> - éŸ³é¢‘è´¨é‡ (å¯é€‰ï¼Œé»˜è®¤: high) <span class="badge new">æ–°å‚æ•°</span></li>
            </ul>
            
            <div class="highlight-box">
                <h4>ğŸ¯ æ ¼å¼å’Œè´¨é‡é€‰æ‹©æŒ‡å—</h4>
                <p><strong>æ ¼å¼é€‰æ‹©:</strong></p>
                <ul style="margin-bottom: 10px;">
                    <li><strong>WAV</strong>: æ— æŸæ ¼å¼ï¼ŒéŸ³è´¨æœ€ä½³ï¼Œæ–‡ä»¶è¾ƒå¤§</li>
                    <li><strong>MP3</strong>: æœ‰æŸå‹ç¼©ï¼Œæ–‡ä»¶å°ï¼Œé€‚åˆä¸€èˆ¬ä½¿ç”¨</li>
                    <li><strong>FLAC</strong>: æ— æŸå‹ç¼©ï¼ŒéŸ³è´¨ä½³ï¼Œæ–‡ä»¶é€‚ä¸­</li>
                </ul>
                <p><strong>è´¨é‡é€‰æ‹©:</strong></p>
                <ul>
                    <li><strong>lossless</strong>: ä¸“ä¸šåˆ¶ä½œï¼Œå®Œå…¨æ— æŸ</li>
                    <li><strong>high</strong>: æ—¥å¸¸ä½¿ç”¨æœ€ä½³å¹³è¡¡</li>
                    <li><strong>medium</strong>: ç§»åŠ¨è®¾å¤‡ä¼˜åŒ–</li>
                    <li><strong>low</strong>: å¿«é€Ÿé¢„è§ˆï¼Œæœ€å°æ–‡ä»¶</li>
                </ul>
            </div>
            
            <p><strong>ç¤ºä¾‹å“åº”:</strong></p>
            <pre>{
  "status": "success",
  "data": {
    "job_id": "85f3da9c-7214-4892-b7bd-1e6e498c5d7b",
    "message": "Audio separation started",
    "status_url": "/api/status/85f3da9c-7214-4892-b7bd-1e6e498c5d7b",
    "progress_url": "/api/progress/85f3da9c-7214-4892-b7bd-1e6e498c5d7b",
    "download_url": "/api/download/85f3da9c-7214-4892-b7bd-1e6e498c5d7b"
  }
}</pre>
            
            <p><strong>ä½¿ç”¨ç¤ºä¾‹ (cURL) - åŸºç¡€è°ƒç”¨:</strong></p>
            <pre>curl -X POST \
  http://localhost:8080/api/process \
  -F "file=@song.mp3" \
  -F "model=htdemucs" \
  -F "stems=vocals,drums"</pre>
            
            <p><strong>ä½¿ç”¨ç¤ºä¾‹ (cURL) - å¸¦æ ¼å¼å’Œè´¨é‡å‚æ•°:</strong></p>
            <pre>curl -X POST \
  http://localhost:8080/api/process \
  -F "file=@song.mp3" \
  -F "model=htdemucs" \
  -F "stems=vocals,drums" \
  -F "output_format=mp3" \
  -F "audio_quality=high"</pre>
            
            <p><strong>ä½¿ç”¨ç¤ºä¾‹ (JavaScript) - å®Œæ•´åŠŸèƒ½:</strong></p>
            <pre>const formData = new FormData();
formData.append('file', audioFile); // Fileå¯¹è±¡
formData.append('model', 'htdemucs');
formData.append('stems', 'vocals,drums');
formData.append('output_format', 'mp3'); // æ–°å¢æ ¼å¼å‚æ•°
formData.append('audio_quality', 'high'); // æ–°å¢è´¨é‡å‚æ•°

// ä½¿ç”¨BASE_URLä½œä¸ºAPIå‰ç¼€
const BASE_URL = "{{ base_url }}" || window.location.origin;
fetch(`${BASE_URL}/api/process`, {
  method: 'POST',
  body: formData
})
.then(response => response.json())
.then(data => {
  if (data.status === 'success') {
    console.log('ä»»åŠ¡åˆ›å»ºæˆåŠŸ:', data.data.job_id);
    // å¼€å§‹ç›‘æ§è¿›åº¦
    monitorProgress(data.data.job_id);
  } else {
    console.error('ä»»åŠ¡åˆ›å»ºå¤±è´¥:', data.message);
  }
});</pre>
        </div>

        <!-- 5. è·å–ä»»åŠ¡çŠ¶æ€ -->
        <div class="card" id="api-status">
            <h3>5. è·å–ä»»åŠ¡çŠ¶æ€</h3>
            <p><strong>ç«¯ç‚¹:</strong> <code>GET /api/status/{job_id}</code></p>
            <p><strong>æè¿°:</strong> è·å–æŒ‡å®šä»»åŠ¡çš„å½“å‰çŠ¶æ€å’Œè¿›åº¦</p>
            <p><strong>ç¤ºä¾‹å“åº”:</strong></p>
            <pre>{
  "status": "success",
  "data": {
    "job_id": "85f3da9c-7214-4892-b7bd-1e6e498c5d7b",
    "progress": 65,
    "message": "æ­£åœ¨å¤„ç†éŸ³é¢‘...",
    "status": "processing"
  }
}</pre>
            <p><strong>ä½¿ç”¨ç¤ºä¾‹ (cURL):</strong></p>
            <pre>curl -X GET http://localhost:8080/api/status/85f3da9c-7214-4892-b7bd-1e6e498c5d7b</pre>
        </div>

        <!-- 6. å®æ—¶è¿›åº¦æ›´æ–° -->
        <div class="card" id="api-progress">
            <h3>6. å®æ—¶è¿›åº¦æ›´æ–°</h3>
            <p><strong>ç«¯ç‚¹:</strong> <code>GET /api/progress/{job_id}</code></p>
            <p><strong>æè¿°:</strong> é€šè¿‡Server-Sent Events (SSE)æ¥æ”¶å®æ—¶è¿›åº¦æ›´æ–°</p>
            <p><strong>è¿”å›:</strong> text/event-stream æ ¼å¼çš„æ•°æ®æµ</p>
            <p><strong>ä½¿ç”¨ç¤ºä¾‹ (JavaScript):</strong></p>
            <pre>// è·å–åŸºç¡€URLè·¯å¾„
const BASE_URL = "{{ base_url }}" || window.location.origin;
const eventSource = new EventSource(`${BASE_URL}/api/progress/85f3da9c-7214-4892-b7bd-1e6e498c5d7b`);

eventSource.onmessage = (event) => {
  const progress = JSON.parse(event.data);
  console.log(`è¿›åº¦: ${progress.progress}%, æ¶ˆæ¯: ${progress.message}`);
  
  // å½“ä»»åŠ¡å®Œæˆæˆ–å‡ºé”™æ—¶å…³é—­è¿æ¥
  if (progress.status === 'completed' || progress.status === 'error') {
    eventSource.close();
  }
};</pre>
        </div>

        <!-- 7. ä¸‹è½½å¤„ç†ç»“æœ -->
        <div class="card" id="api-download">
            <h3>7. ä¸‹è½½å¤„ç†ç»“æœ</h3>
            <p><strong>ç«¯ç‚¹:</strong> <code>GET /api/download/{job_id}</code></p>
            <p><strong>æè¿°:</strong> ä¸‹è½½å·²å®Œæˆä»»åŠ¡çš„åˆ†ç¦»éŸ³è½¨ï¼ˆZIPæ ¼å¼ï¼‰</p>
            <p><strong>è¿”å›:</strong> application/zip æ–‡ä»¶</p>
            <p><strong>ä½¿ç”¨ç¤ºä¾‹ (cURL):</strong></p>
            <pre>curl -X GET \
  http://localhost:8080/api/download/85f3da9c-7214-4892-b7bd-1e6e498c5d7b \
  --output separated_tracks.zip</pre>
            <p><strong>ä½¿ç”¨ç¤ºä¾‹ (JavaScript):</strong></p>
            <pre>// ç¤ºä¾‹: ä¸‹è½½å¤„ç†ç»“æœ
const downloadResult = (jobId) => {
  const BASE_URL = "{{ base_url }}" || window.location.origin;
  window.location.href = `${BASE_URL}/api/download/${jobId}`;
  
  // æˆ–è€…ä½¿ç”¨fetchå¹¶ä¿å­˜æ–‡ä»¶
  fetch(`${BASE_URL}/api/download/${jobId}`)
    .then(response => response.blob())
    .then(blob => {
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'separated_tracks.zip';
      document.body.appendChild(a);
      a.click();
      window.URL.revokeObjectURL(url);
    });
};</pre>
        </div>

        <!-- 8. æ¸…ç†ä»»åŠ¡æ–‡ä»¶ -->
        <div class="card" id="api-cleanup">
            <h3>8. æ¸…ç†ä»»åŠ¡æ–‡ä»¶</h3>
            <p><strong>ç«¯ç‚¹:</strong> <code>DELETE /api/cleanup/{job_id}</code></p>
            <p><strong>æè¿°:</strong> æ¸…ç†æŒ‡å®šä»»åŠ¡çš„ç›¸å…³æ–‡ä»¶ï¼Œé‡Šæ”¾æœåŠ¡å™¨å­˜å‚¨ç©ºé—´</p>
            <p><strong>ç¤ºä¾‹å“åº”:</strong></p>
            <pre>{
  "status": "success",
  "data": {
    "message": "ä»»åŠ¡æ–‡ä»¶å·²æˆåŠŸæ¸…ç†"
  }
}</pre>
            <p><strong>ä½¿ç”¨ç¤ºä¾‹ (cURL):</strong></p>
            <pre>curl -X DELETE http://localhost:8080/api/cleanup/85f3da9c-7214-4892-b7bd-1e6e498c5d7b</pre>
        </div>

        <div class="tip">
            <strong>æ³¨æ„:</strong> æ‰€æœ‰APIè¯·æ±‚è¿”å›çš„HTTPçŠ¶æ€ç ä¸º200ï¼ˆæˆåŠŸï¼‰æˆ–4xx/5xxï¼ˆé”™è¯¯ï¼‰ã€‚å“åº”ä½“ä¸­çš„statuså­—æ®µä¼šæŒ‡ç¤ºå…·ä½“æ“ä½œæ˜¯æˆåŠŸè¿˜æ˜¯å¤±è´¥ã€‚ç³»ç»Ÿä¼šåœ¨ä¸€å®šæ—¶é—´åï¼ˆé»˜è®¤1å°æ—¶ï¼‰è‡ªåŠ¨æ¸…ç†æœªè¢«ä¸‹è½½çš„æ–‡ä»¶ã€‚
        </div>

        <!-- APIæ¥å£è°ƒç”¨æµç¨‹ -->
        <div class="card" id="api-flow">
            <h2>ğŸ”„ APIæ¥å£è°ƒç”¨æµç¨‹</h2>
            <h3>å…¸å‹ä½¿ç”¨æµç¨‹</h3>
            <p>ä»¥ä¸‹æ˜¯éŸ³é¢‘åˆ†ç¦»å¤„ç†çš„å®Œæ•´æµç¨‹å’ŒAPIè°ƒç”¨é¡ºåºï¼š</p>
            
            <ol>
                <li>
                    <strong>è·å–å¯ç”¨é€‰é¡¹</strong> (å¯é€‰ä½†æ¨è) <span class="badge updated">å·²å‡çº§</span>
                    <p>åœ¨å¼€å§‹å¤„ç†ä¹‹å‰ï¼Œæ‚¨å¯ä»¥è·å–ç³»ç»Ÿæ”¯æŒçš„å„ç§é€‰é¡¹:</p>
                    <ul>
                        <li>è°ƒç”¨ <code>GET /api/models</code> è·å–å¯ç”¨çš„æ¨¡å‹åˆ—è¡¨</li>
                        <li>è°ƒç”¨ <code>GET /api/formats</code> è·å–æ”¯æŒçš„è¾“å‡ºæ ¼å¼ <span class="badge new">æ–°å¢</span></li>
                        <li>è°ƒç”¨ <code>GET /api/qualities</code> è·å–éŸ³é¢‘è´¨é‡é€‰é¡¹ <span class="badge new">æ–°å¢</span></li>
                    </ul>
                    <pre>// ç¤ºä¾‹: è·å–æ‰€æœ‰é€‰é¡¹ç”¨äºæ„å»ºUI
const loadOptions = async () => {
  const BASE_URL = "{{ base_url }}" || window.location.origin;
  
  try {
    // å¹¶è¡Œè·å–æ‰€æœ‰é€‰é¡¹
    const [modelsRes, formatsRes, qualitiesRes] = await Promise.all([
      fetch(`${BASE_URL}/api/models`),
      fetch(`${BASE_URL}/api/formats`),
      fetch(`${BASE_URL}/api/qualities`)
    ]);
    
    const models = await modelsRes.json();
    const formats = await formatsRes.json();
    const qualities = await qualitiesRes.json();
    
    console.log('å¯ç”¨æ¨¡å‹:', models.data.models);
    console.log('æ”¯æŒæ ¼å¼:', formats.data.formats);
    console.log('è´¨é‡é€‰é¡¹:', qualities.data.qualities);
    
    // ç”¨äºæ„å»ºé€‰æ‹©ç•Œé¢
    buildUI(models.data, formats.data, qualities.data);
    
  } catch (error) {
    console.error('è·å–é€‰é¡¹å¤±è´¥:', error);
  }
};</pre>
                </li>
                <li>
                    <strong>æäº¤éŸ³é¢‘å¤„ç†ä»»åŠ¡</strong> (å¿…éœ€) <span class="badge updated">å·²å‡çº§</span>
                    <p>è°ƒç”¨ <code>POST /api/process</code> ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶å¹¶è·å–ä»»åŠ¡IDï¼Œç°åœ¨æ”¯æŒæ ¼å¼å’Œè´¨é‡æ§åˆ¶ã€‚</p>
                    <pre>// ç¤ºä¾‹: æäº¤å¤„ç†ä»»åŠ¡ï¼ˆå®Œæ•´åŠŸèƒ½ç‰ˆï¼‰
const submitAudioTask = async (audioFile, options = {}) => {
  const BASE_URL = "{{ base_url }}" || window.location.origin;
  
  const formData = new FormData();
  formData.append('file', audioFile);
  
  // åŸºç¡€å‚æ•°
  formData.append('model', options.model || 'htdemucs');
  formData.append('stems', options.stems || 'vocals,drums,bass,other');
  
  // æ–°å¢çš„æ ¼å¼å’Œè´¨é‡å‚æ•°
  formData.append('output_format', options.output_format || 'mp3');
  formData.append('audio_quality', options.audio_quality || 'high');
  
  try {
    const response = await fetch(`${BASE_URL}/api/process`, {
      method: 'POST',
      body: formData
    });
    
    const result = await response.json();
    
    if (result.status === 'success') {
      console.log('ä»»åŠ¡åˆ›å»ºæˆåŠŸ:', result.data.job_id);
      return result.data.job_id;
    } else {
      throw new Error(result.message || 'ä»»åŠ¡åˆ›å»ºå¤±è´¥');
    }
    
  } catch (error) {
    console.error('ä»»åŠ¡æäº¤å¤±è´¥:', error);
    throw error;
  }
};</pre>
                </li>
                <li>
                    <strong>ç›‘æ§å¤„ç†è¿›åº¦</strong> (äºŒé€‰ä¸€)
                    <ul>
                        <li>
                            <strong>æ–¹æ³•1: è½®è¯¢</strong>
                            <p>å®šæœŸè°ƒç”¨ <code>GET /api/status/{job_id}</code> è·å–æœ€æ–°è¿›åº¦ã€‚</p>
                        </li>
                        <li>
                            <strong>æ–¹æ³•2: SSEå®æ—¶æ›´æ–°</strong> (æ¨è)
                            <p>å»ºç«‹ <code>GET /api/progress/{job_id}</code> SSEè¿æ¥ï¼Œæ¥æ”¶å®æ—¶è¿›åº¦æ›´æ–°ã€‚</p>
                        </li>
                    </ul>
                </li>
                <li>
                    <strong>ä¸‹è½½å¤„ç†ç»“æœ</strong> (ä»»åŠ¡å®Œæˆå)
                    <p>ä»»åŠ¡å®Œæˆåè°ƒç”¨ <code>GET /api/download/{job_id}</code> ä¸‹è½½åˆ†ç¦»çš„éŸ³è½¨ã€‚</p>
                </li>
                <li>
                    <strong>æ¸…ç†èµ„æº</strong> (å¯é€‰ä½†æ¨è)
                    <p>ä¸‹è½½å®Œæˆåè°ƒç”¨ <code>DELETE /api/cleanup/{job_id}</code> æ¸…ç†æœåŠ¡å™¨ä¸Šçš„ä¸´æ—¶æ–‡ä»¶ã€‚</p>
                </li>
            </ol>
        </div>
    </div>

    <footer>
        <div class="container">
            <p>DemucséŸ³é¢‘åˆ†ç¦»å·¥å…· &copy; 2024 | åŸºäº<a href="https://github.com/facebookresearch/demucs" style="color: white; text-decoration: underline;">Demucs</a>å¼€å‘</p>
        </div>
    </footer>
</body>
</html> 