# æµ‹è¯•ç›®å½•ç»“æ„è¯´æ˜

æœ¬ç›®å½•åŒ…å«DemucséŸ³é¢‘åˆ†ç¦»åº”ç”¨çš„å®Œæ•´æµ‹è¯•å¥—ä»¶ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
test/
â”œâ”€â”€ README.md                      # æœ¬æ–‡æ¡£
â”œâ”€â”€ run_tests.py                   # æµ‹è¯•è¿è¡Œå™¨è„šæœ¬
â”œâ”€â”€ test_suite.py                  # é«˜çº§æµ‹è¯•å¥—ä»¶ç®¡ç†å™¨
â”œâ”€â”€ quick_test.py                  # å¿«é€ŸéªŒè¯è„šæœ¬
â”œâ”€â”€ test.mp3                       # æµ‹è¯•éŸ³é¢‘æ–‡ä»¶
â”œâ”€â”€ test_files.md                  # æµ‹è¯•æ–‡ä»¶ä½¿ç”¨è¯´æ˜
â”‚
â”œâ”€â”€ unit/                          # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_api.py               # APIæ¥å£æµ‹è¯•
â”‚   â”œâ”€â”€ test_demucs.py            # Demucsæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ test_download_functionality.py # ä¸‹è½½åŠŸèƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ test_fixed_separator.py   # éŸ³é¢‘åˆ†ç¦»å™¨ä¿®å¤æµ‹è¯•
â”‚   â”œâ”€â”€ test_full_app.py          # å…¨åº”ç”¨é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_ffmpeg_compatibility.py # FFmpegå…¼å®¹æ€§æµ‹è¯•
â”‚   â””â”€â”€ test_progress_feedback.py # è¿›åº¦åé¦ˆæµ‹è¯•
â”‚
â”œâ”€â”€ integration/                   # é›†æˆæµ‹è¯•
â”‚   â””â”€â”€ (å¾…è§„åˆ’)
â”‚
â”œâ”€â”€ mcp/                          # MCPåè®®æµ‹è¯•
â”‚   â”œâ”€â”€ README.md                 # MCPæµ‹è¯•è¯´æ˜
â”‚   â””â”€â”€ client.py                 # MCPå®¢æˆ·ç«¯æµ‹è¯•
â”‚
â”œâ”€â”€ output/                       # æµ‹è¯•è¾“å‡ºæ–‡ä»¶å¤¹
â”‚   â””â”€â”€ *.wav                     # ç”Ÿæˆçš„æµ‹è¯•éŸ³é¢‘æ–‡ä»¶
â”‚
â””â”€â”€ fixtures/                     # æµ‹è¯•æ•°æ®
    â””â”€â”€ (æµ‹è¯•ç”¨æ•°æ®æ–‡ä»¶)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
cd test
python run_tests.py
```

### 2. è¿è¡Œç‰¹å®šç±»å‹æµ‹è¯•
```bash
# FFmpegå…¼å®¹æ€§æµ‹è¯•
python run_tests.py --test ffmpeg

# è¿›åº¦åé¦ˆæµ‹è¯•
python run_tests.py --test progress

# APIæ¥å£æµ‹è¯•
python run_tests.py --test api

# ä¸‹è½½åŠŸèƒ½æµ‹è¯•
python run_tests.py --test download

# å•ç‹¬è¿è¡ŒæŸä¸ªæµ‹è¯•æ–‡ä»¶
python test_demucs.py
python test_full_app.py
python unit/test_download_functionality.py
```

### 3. å‰ç½®æ¡ä»¶

è¿è¡Œæµ‹è¯•å‰ç¡®ä¿ï¼š

- âœ… å·²å®‰è£…æ‰€æœ‰ä¾èµ–ï¼š`pip install -r ../requirements.txt`
- âœ… æµ‹è¯•éŸ³é¢‘æ–‡ä»¶å­˜åœ¨ï¼š`test.mp3`
- âœ… å¯¹äºAPIæµ‹è¯•ï¼šç¡®ä¿åº”ç”¨æœåŠ¡å™¨è¿è¡Œåœ¨ `http://127.0.0.1:8080`

## ğŸ“‹ æµ‹è¯•æ¨¡å—è¯´æ˜

### æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | çŠ¶æ€ |
|---------|---------|------|
| `test_demucs.py` | Demucsæ¨¡å‹åŸºæœ¬åŠŸèƒ½ | âœ… |
| `test_fixed_separator.py` | éŸ³é¢‘åˆ†ç¦»å™¨ä¿®å¤éªŒè¯ | âœ… |
| `test_full_app.py` | å®Œæ•´åº”ç”¨æµç¨‹æµ‹è¯• | âœ… |

### å…¼å®¹æ€§æµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | çŠ¶æ€ |
|---------|---------|------|
| `test_ffmpeg_compatibility.py` | FFmpegåº“åŠ è½½å’Œå…¼å®¹æ€§ | âœ… |
| `test_progress_feedback.py` | è¿›åº¦å›è°ƒæœºåˆ¶ | âœ… |

### æ¥å£æµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | çŠ¶æ€ |
|---------|---------|------|
| `test_api.py` | HTTP APIæ¥å£å®Œæ•´æµ‹è¯• | âœ… |
| `test_download_functionality.py` | æ–‡ä»¶ä¸‹è½½åŠŸèƒ½å®Œæ•´æµ‹è¯• | âœ… |

### MCPåè®®æµ‹è¯•

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | çŠ¶æ€ |
|---------|---------|------|
| `mcp/client.py` | MCPå®¢æˆ·ç«¯é€šä¿¡æµ‹è¯• | âœ… |

## ğŸ”§ æµ‹è¯•é…ç½®

### ç¯å¢ƒå˜é‡
```bash
# æµ‹è¯•æœåŠ¡å™¨åœ°å€
export TEST_SERVER_URL="http://127.0.0.1:8080"

# æµ‹è¯•è¶…æ—¶æ—¶é—´
export TEST_TIMEOUT=300
```

### æµ‹è¯•å‚æ•°

å¯ä»¥åœ¨å„æµ‹è¯•æ–‡ä»¶ä¸­ä¿®æ”¹ä»¥ä¸‹å‚æ•°ï¼š

- **è®¾å¤‡é€‰æ‹©**ï¼š`device = "cpu"` æˆ– `device = "cuda"`
- **æ¨¡å‹é€‰æ‹©**ï¼š`model_name = "htdemucs"`
- **éŸ³é¢‘æ ¼å¼**ï¼šæ”¯æŒ mp3, wav, flac ç­‰
- **åˆ†ç¦»è½¨é“**ï¼š`["vocals", "drums", "bass", "other"]`

## ğŸ› å¸¸è§é—®é¢˜

### 1. å†…å­˜ä¸è¶³
```python
# åœ¨æµ‹è¯•ä¸­é™ä½é‡‡æ ·ç‡
config = {
    'SAMPLE_RATE': 16000,  # é™ä½åˆ°16kHz
    'CHANNELS': 1          # ä½¿ç”¨å•å£°é“
}
```

### 2. æµ‹è¯•éŸ³é¢‘æ–‡ä»¶ç¼ºå¤±
```bash
# ä¸‹è½½æµ‹è¯•éŸ³é¢‘æ–‡ä»¶
wget -O test.mp3 "https://example.com/test-audio.mp3"
# æˆ–è€…ä½¿ç”¨ä»»æ„çŸ­éŸ³é¢‘æ–‡ä»¶é‡å‘½åä¸ºtest.mp3
```

### 3. APIæµ‹è¯•å¤±è´¥
```bash
# ç¡®ä¿åº”ç”¨æœåŠ¡å™¨åœ¨è¿è¡Œ
python ../run.py

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡ŒAPIæµ‹è¯•
python test_api.py
```

### 4. GPU/CUDAé—®é¢˜
```python
# å¼ºåˆ¶ä½¿ç”¨CPUæµ‹è¯•
import torch
if not torch.cuda.is_available():
    device = "cpu"
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

æµ‹è¯•å®Œæˆåä¼šç”Ÿæˆä»¥ä¸‹è¾“å‡ºï¼š

- ğŸŸ¢ **PASS**: æµ‹è¯•é€šè¿‡
- ğŸ”´ **FAIL**: æµ‹è¯•å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
- ğŸŸ¡ **SKIP**: æµ‹è¯•è·³è¿‡ï¼ˆå¦‚ç¼ºå°‘ä¾èµ–ï¼‰

### ç¤ºä¾‹è¾“å‡º
```
=== è¿è¡Œæ‰€æœ‰æµ‹è¯• ===
test_model_loading (__main__.TestDemucs) ... ok
test_audio_separation (__main__.TestDemucs) ... ok
test_api_models (__main__.TestAPI) ... ok
test_file_upload (__main__.TestAPI) ... ok

----------------------------------------------------------------------
Ran 4 tests in 45.123s

OK
```

## ğŸ”„ æŒç»­é›†æˆ

æµ‹è¯•è„šæœ¬æ”¯æŒCI/CDé›†æˆï¼š

```bash
# åœ¨CIç¯å¢ƒä¸­è¿è¡Œ
python test/run_tests.py --test all
echo "Exit code: $?"
```

## ğŸ“ è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°æµ‹è¯•

1. åœ¨ç›¸åº”ç›®å½•åˆ›å»ºæµ‹è¯•æ–‡ä»¶
2. ç»§æ‰¿ `unittest.TestCase`
3. æ·»åŠ åˆ° `run_tests.py` ä¸­
4. æ›´æ–°æœ¬READMEæ–‡æ¡£

### æµ‹è¯•å‘½åè§„èŒƒ

- æµ‹è¯•æ–‡ä»¶ï¼š`test_<æ¨¡å—å>.py`
- æµ‹è¯•ç±»ï¼š`Test<åŠŸèƒ½å>`
- æµ‹è¯•æ–¹æ³•ï¼š`test_<å…·ä½“åŠŸèƒ½>`

### ç¤ºä¾‹æµ‹è¯•ç»“æ„

```python
import unittest

class TestNewFeature(unittest.TestCase):
    def setUp(self):
        """æµ‹è¯•å‰ç½®æ¡ä»¶"""
        pass
    
    def test_basic_functionality(self):
        """æµ‹è¯•åŸºæœ¬åŠŸèƒ½"""
        pass
    
    def tearDown(self):
        """æµ‹è¯•æ¸…ç†"""
        pass

if __name__ == '__main__':
    unittest.main()
```

## ğŸ“ æ”¯æŒ

å¦‚æœé‡åˆ°æµ‹è¯•é—®é¢˜ï¼š

1. æ£€æŸ¥æ˜¯å¦æ»¡è¶³å‰ç½®æ¡ä»¶
2. æŸ¥çœ‹å…·ä½“é”™è¯¯ä¿¡æ¯
3. å‚è€ƒå¸¸è§é—®é¢˜éƒ¨åˆ†
4. æŸ¥çœ‹ç›¸å…³æµ‹è¯•æ–‡ä»¶çš„æ³¨é‡Šè¯´æ˜ 