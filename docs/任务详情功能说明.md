# 任务详情功能说明

## 📋 功能概述

任务详情功能允许管理员查看每个音频分离任务的完整信息，包括所有相关文件的详细路径、大小、修改时间等信息。

## ✨ 主要功能

### 📊 基本信息显示
- **任务ID**：完整的UUID格式任务标识符
- **任务状态**：已完成/处理中/失败/过期状态
- **创建时间**：任务开始的时间戳
- **最后更新**：最近文件修改的时间戳
- **文件统计**：输入和输出文件的数量统计
- **总大小**：任务所有文件的总大小

### 📁 文件列表管理
- **输入文件区域**：显示原始音频文件
- **输出文件区域**：显示分离后的音轨文件
- **完整路径显示**：每个文件都显示完整的服务器路径
- **文件元信息**：文件大小、修改时间等详细信息

### 🔧 文件操作功能
- **📋 复制路径**：一键复制文件的完整路径到剪贴板
- **📥 下载文件**：直接下载单个输出文件
- **🗑️ 删除文件**：删除特定的输入或输出文件
- **📦 批量下载**：下载任务的所有输出文件（功能开发中）

## 🚀 使用方法

### 1. 打开任务详情
```
1. 登录管理面板：http://localhost:8080/admin
2. 在任务列表中找到目标任务
3. 点击任务行右侧的"📋 详情"按钮
4. 弹出详情模态框显示完整信息
```

### 2. 查看文件信息
```
- 左侧显示输入文件（原始音频）
- 右侧显示输出文件（分离后的音轨）
- 每个文件都显示：
  * 文件名
  * 完整服务器路径
  * 文件大小
  * 最后修改时间
```

### 3. 文件操作
```
复制路径：点击"📋 复制路径"按钮
下载文件：点击"📥 下载"按钮（仅输出文件）
删除文件：点击"🗑️ 删除"按钮并确认
```

## 💻 技术实现

### API 接口
```http
GET /admin/api/tasks/{task_id}/details
```

**响应格式：**
```json
{
  "status": "success",
  "data": {
    "task_id": "abc12345-1234-5678-9012-123456789abc",
    "status": "completed",
    "created_time": 1234567890.123,
    "latest_time": 1234567890.456,
    "total_size": 52428800,
    "is_old": false,
    "input_files": [
      {
        "name": "song.mp3",
        "path": "/demucs/uploads/song_abc12345.mp3",
        "size": 10485760,
        "modified_time": 1234567890.123,
        "type": "input"
      }
    ],
    "output_files": [
      {
        "name": "song_vocals.mp3",
        "path": "/demucs/outputs/20250101/abc12345/song_vocals.mp3",
        "size": 8388608,
        "modified_time": 1234567890.456,
        "type": "output"
      }
    ]
  }
}
```

### 前端组件
- **模态框组件**：使用CSS Grid布局响应式设计
- **文件列表组件**：支持大量文件的高效显示
- **剪贴板API**：现代浏览器clipboard API + 降级方案
- **确认对话框**：删除操作的安全确认机制

## 🎨 界面设计

### 响应式布局
- **桌面端**：双栏布局，输入/输出文件并排显示
- **移动端**：单栏布局，输入/输出文件垂直排列
- **适配性**：支持各种屏幕尺寸和分辨率

### 用户体验
- **即时反馈**：所有操作都有即时的视觉反馈
- **加载状态**：数据加载时显示旋转加载动画
- **错误处理**：网络错误和服务器错误的友好提示
- **键盘支持**：ESC键关闭模态框等快捷操作

## 🔒 安全特性

### 路径验证
- 文件路径安全检查，防止目录遍历攻击
- 只允许访问配置的上传和输出目录
- 文件操作权限验证

### 权限控制
- 需要管理员登录认证
- 使用`@admin_required`装饰器保护API
- 会话超时自动登出

## 📱 浏览器兼容性

### 支持的浏览器
- **Chrome/Edge**: 88+
- **Firefox**: 85+
- **Safari**: 14+
- **移动浏览器**: 支持现代移动浏览器

### 功能降级
- 剪贴板API不支持时使用传统方法
- CSS Grid不支持时使用Flexbox降级
- JavaScript模块不支持时使用传统脚本

## 🐛 故障排除

### 常见问题
1. **任务详情加载失败**
   - 检查任务ID是否正确
   - 确认文件系统权限
   - 查看服务器日志

2. **文件路径复制失败**
   - 检查浏览器剪贴板权限
   - 尝试手动选择和复制
   - 使用HTTPS协议

3. **文件下载失败**
   - 确认文件仍然存在
   - 检查服务器磁盘空间
   - 验证网络连接

### 日志查看
```bash
# 查看应用日志
tail -f logs/app.log

# 查看管理员操作日志
grep "管理员" logs/app.log
```

## 🔄 未来改进

### 计划功能
- [ ] 批量下载ZIP压缩包
- [ ] 文件预览功能（音频播放器）
- [ ] 任务重新处理功能
- [ ] 文件移动和重命名
- [ ] 任务导出和导入

### 性能优化
- [ ] 文件列表虚拟滚动
- [ ] 大文件异步加载
- [ ] 缓存机制优化
- [ ] 数据库索引优化

---

**更新时间**: 2025年1月23日  
**版本**: v1.0.0  
**维护者**: Demucs团队 